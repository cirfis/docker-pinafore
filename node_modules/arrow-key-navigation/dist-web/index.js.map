{"version":3,"file":"index.js","sources":["../dist-src/index.js"],"sourcesContent":["/**\n * Makes it so the left and right arrows change focus, ala Tab/Shift+Tab. This is mostly designed\n * for KaiOS devices.\n */\n/* global document, addEventListener, removeEventListener, getSelection */\n// TODO: email/number types are a special type, in that they return selectionStart/selectionEnd as null\n// As far as I can tell, there is no way to actually get the caret position from these inputs. So we\n// don't do the proper caret handling for those inputs, unfortunately.\n// https://html.spec.whatwg.org/multipage/input.html#do-not-apply\nvar textInputTypes = ['text', 'search', 'url', 'password', 'tel'];\nvar checkboxRadioInputTypes = ['checkbox', 'radio'];\nvar focusTrapTest = undefined;\n// This query is adapted from a11y-dialog\n// https://github.com/edenspiekermann/a11y-dialog/blob/cf4ed81/a11y-dialog.js#L6-L18\nvar focusablesQuery = 'a[href], area[href], input, select, textarea, ' +\n    'button, iframe, object, embed, [contenteditable], [tabindex], ' +\n    'video[controls], audio[controls], summary';\nfunction getActiveElement() {\n    var activeElement = document.activeElement;\n    while (activeElement.shadowRoot) {\n        activeElement = activeElement.shadowRoot.activeElement;\n    }\n    return activeElement;\n}\nfunction isFocusable(element) {\n    return element.matches(focusablesQuery) &&\n        !element.disabled &&\n        !/^-/.test(element.getAttribute('tabindex') || '') &&\n        !element.hasAttribute('inert') && // see https://github.com/GoogleChrome/inert-polyfill\n        (element.offsetWidth > 0 || element.offsetHeight > 0);\n}\nfunction getFocusTrapParent(element) {\n    if (!focusTrapTest) {\n        return;\n    }\n    var parent = element.parentElement;\n    while (parent) {\n        if (focusTrapTest(parent)) {\n            return parent;\n        }\n        parent = parent.parentElement;\n    }\n}\nfunction shouldIgnoreEvent(activeElement, forwardDirection) {\n    var tagName = activeElement.tagName;\n    var isTextarea = tagName === 'TEXTAREA';\n    var isTextInput = tagName === 'INPUT' &&\n        textInputTypes.indexOf(activeElement.getAttribute('type').toLowerCase()) !== -1;\n    var isContentEditable = activeElement.hasAttribute('contenteditable');\n    if (!isTextarea && !isTextInput && !isContentEditable) {\n        return false;\n    }\n    var selectionStart;\n    var selectionEnd;\n    var len;\n    if (isContentEditable) {\n        var selection = getSelection();\n        selectionStart = selection.anchorOffset;\n        selectionEnd = selection.focusOffset;\n        len = activeElement.textContent.length;\n    }\n    else {\n        selectionStart = activeElement.selectionStart;\n        selectionEnd = activeElement.selectionEnd;\n        len = activeElement.value.length;\n    }\n    // if the cursor is inside of a textarea/input, then don't focus to the next/previous element\n    // unless the cursor is at the beginning or the end\n    if (!forwardDirection && selectionStart === selectionEnd && selectionStart === 0) {\n        return false;\n    }\n    else if (forwardDirection && selectionStart === selectionEnd && selectionStart === len) {\n        return false;\n    }\n    return true;\n}\nfunction getNextCandidateNodeForShadowDomPolyfill(root, targetElement, forwardDirection, filter) {\n    // When the shadydom polyfill is running, we can't use TreeWalker on ShadowRoots because\n    // they aren't real Nodes. So we do this workaround where we run TreeWalker on the\n    // children instead.\n    var nodes = Array.prototype.slice.call(root.querySelectorAll('*'));\n    var idx = nodes.indexOf(targetElement);\n    if (forwardDirection) {\n        nodes = nodes.slice(idx + 1);\n    }\n    else {\n        if (idx === -1) {\n            idx = nodes.length;\n        }\n        nodes = nodes.slice(0, idx);\n        nodes.reverse();\n    }\n    for (var i = 0; i < nodes.length; i++) {\n        var node = nodes[i];\n        if (node instanceof HTMLElement && filter.acceptNode(node) === NodeFilter.FILTER_ACCEPT) {\n            return node;\n        }\n    }\n    return undefined;\n}\nfunction getNextCandidateNode(root, targetElement, forwardDirection, filter) {\n    var walker = document.createTreeWalker(root, NodeFilter.SHOW_ELEMENT, filter);\n    if (targetElement) {\n        walker.currentNode = targetElement;\n    }\n    if (forwardDirection) {\n        return walker.nextNode();\n    }\n    else if (targetElement) {\n        return walker.previousNode();\n    }\n    // iterating backwards through shadow root, use last child\n    return walker.lastChild();\n}\nfunction isShadowDomPolyfill() {\n    return typeof ShadowRoot !== 'undefined' &&\n        // ShadowRoot.polyfill is just a hack for our unit tests\n        ('polyfill' in ShadowRoot || !ShadowRoot.toString().includes('[native code]'));\n}\nfunction getNextNode(root, targetElement, forwardDirection) {\n    var filter = {\n        acceptNode: function (node) {\n            return (node === targetElement || node.shadowRoot || isFocusable(node))\n                ? NodeFilter.FILTER_ACCEPT\n                : NodeFilter.FILTER_SKIP;\n        }\n    };\n    // TODO: remove this when we don't need to support the Shadow DOM polyfill\n    var nextNode = isShadowDomPolyfill() && root instanceof ShadowRoot\n        ? getNextCandidateNodeForShadowDomPolyfill(root, targetElement, forwardDirection, filter)\n        : getNextCandidateNode(root, targetElement, forwardDirection, filter);\n    if (nextNode && nextNode.shadowRoot) { // push into the shadow DOM\n        return getNextNode(nextNode.shadowRoot, null, forwardDirection);\n    }\n    if (!nextNode && root.host) { // pop out of the shadow DOM\n        return getNextNode(root.host.getRootNode(), root.host, forwardDirection);\n    }\n    return nextNode;\n}\nfunction focusNextOrPrevious(event, key) {\n    var activeElement = getActiveElement();\n    var forwardDirection = key === 'ArrowRight';\n    if (shouldIgnoreEvent(activeElement, forwardDirection)) {\n        return;\n    }\n    var root = getFocusTrapParent(activeElement) || activeElement.getRootNode();\n    var nextNode = getNextNode(root, activeElement, forwardDirection);\n    if (nextNode && nextNode !== activeElement) {\n        nextNode.focus();\n        event.preventDefault();\n    }\n}\nfunction handleEnter(event) {\n    var activeElement = getActiveElement();\n    if (activeElement.tagName === 'INPUT' &&\n        checkboxRadioInputTypes.indexOf(activeElement.getAttribute('type').toLowerCase()) !== -1) {\n        // Explicitly override \"enter\" on an input and make it fire the checkbox/radio\n        activeElement.click();\n        event.preventDefault();\n    }\n}\nfunction keyListener(event) {\n    if (event.altKey || event.metaKey || event.ctrlKey) {\n        return; // ignore e.g. Alt-Left and Ctrl-Right, which are used to switch browser tabs or navigate back/forward\n    }\n    var key = event.key;\n    switch (key) {\n        case 'ArrowLeft':\n        case 'ArrowRight': {\n            focusNextOrPrevious(event, key);\n            break;\n        }\n        case 'Enter': {\n            handleEnter(event);\n            break;\n        }\n    }\n}\n/**\n * Start listening for keyboard events. Attaches a listener to the window.\n */\nfunction register() {\n    addEventListener('keydown', keyListener);\n}\n/**\n * Stop listening for keyboard events. Unattaches a listener to the window.\n */\nfunction unregister() {\n    removeEventListener('keydown', keyListener);\n}\n/**\n * Set a focus trap test to identify any focus traps in the DOM, i.e. a top-level DOM node that indicates the root\n * of a focus trap. Once this is set, if focus changes within the focus trap, then will not leave the focus trap.\n * @param test: the test function\n * @see https://w3c.github.io/aria-practices/examples/dialog-modal/dialog.html\n */\nfunction setFocusTrapTest(test) {\n    focusTrapTest = test;\n}\nexport { register, unregister, setFocusTrapTest };\n"],"names":[],"mappings":"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"}