(this.webpackChunkpinafore=this.webpackChunkpinafore||[]).push([[2943],{1786:(t,e,n)=>{"use strict";n.d(e,{I:()=>g,b:()=>y});var i=n(7569),o=n(2936),s=n(1632),r=n(9921),a=n(2909),c=n(3006),l=n(2846),u=n(8657);function d(t,e,n){const i=function(t,e){const n=o.h.getForTimeline(t,e,"timelineItemSummaries")||[];return new Set(n.map((t=>t.id)))}(t,e);return n.filter((t=>!i.has(t.id)))}async function h(t,e,n){if(!(n=d(t,e,n)).length)return;await a.F.insertTimelineItems(t,e,n);const i=o.h.getForTimeline(t,e,"timelineItemSummariesToAdd")||[];JSON.parse(JSON.stringify(i)),JSON.parse(JSON.stringify(n.map(u.o))),JSON.parse(JSON.stringify((0,c.z)(i,n.map((e=>(0,u.o)(e,t))))));const l=(0,s.Z)((0,c.z)(i,n.map((e=>(0,u.o)(e,t)))),(t=>t.id));(0,r.Z)(i,l)||(l.length,i.length,o.h.setForTimeline(t,e,{timelineItemSummariesToAdd:l}))}function m(t,e,n){const i=new Set(n.map((t=>t.id))),o=new Set(t.map((t=>t.id))),s=e.split("/")[1],r=t.findIndex((t=>t.id===s));return e=>t.findIndex((t=>t.id===e.in_reply_to_id))>=r&&!o.has(e.id)&&!i.has(e.id)}async function p(t,e){if(!e.length)return;const n=o.h.getThreads(t),i=Object.keys(n);for(const a of i){const i=n[a],l=o.h.getForTimeline(t,a,"timelineItemSummariesToAdd")||[],d=e.filter(m(i,a,l));if(!d.length)continue;const h=(0,s.Z)((0,c.z)(l,d.map((e=>(0,u.o)(e,t)))),(t=>t.id));(0,r.Z)(l,h)||(h.length,l.length,o.h.setForTimeline(t,a,{timelineItemSummariesToAdd:h}))}}function f(t,e){(0,l.F)((()=>{!async function(t,e){(0,i.B)("processFreshUpdates");const n=o.h.getForTimeline(t,e,"freshUpdates");if(n&&n.length){const i=n.slice();o.h.setForTimeline(t,e,{freshUpdates:[]}),await Promise.all([h(t,e,i),p(t,i.filter((t=>t.in_reply_to_id)))])}(0,i.s)("processFreshUpdates")}(t,e)}))}function g(t,e,n){y(t,e,[n])}function y(t,e,n){Date.now();let i=o.h.getForTimeline(t,e,"freshUpdates")||[];i=(0,c.z)(i,n),i=(0,s.Z)(i,(t=>t.id)),o.h.setForTimeline(t,e,{freshUpdates:i}),f(t,e)}},1312:(t,e,n)=>{"use strict";n.d(e,{Q0:()=>h,ic:()=>d,Mj:()=>u});var i=n(3242),o=n(2909),s=n(1029),r=n(8273);var a=n(2936),c=n(9921);async function l(t,e){await e((()=>{const{loggedInInstances:e}=a.h.get(),n=e[t].access_token;return function(t,e){const n=`${(0,s.E)(t)}/api/v1/custom_emojis`;return(0,r.U2)(n,(0,s.I)(e),{timeout:r.EH})}(t,n)}),(()=>o.F.getCustomEmoji(t)),(e=>o.F.setCustomEmoji(t,e)),(e=>{const{customEmoji:n}=a.h.get();(0,c.Z)(n[t],e)||(n[t]=e,a.h.set({customEmoji:n}))}))}async function u(t){await l(t,i.u)}async function d(t){await l(t,i.o)}function h(t,e){const n=e.unicode||`:${e.name}:`,{composeSelectionStart:i}=a.h.get(),o=i||0,s=a.h.getComposeData(t,"text")||"",r=`${s.substring(0,o)}${n} ${s.substring(o)}`;a.h.setComposeData(t,{text:r})}},6877:(t,e,n)=>{"use strict";n.d(e,{m:()=>l,h:()=>u});var i=n(2936),o=n(825),s=n(6494),r=n(2846),a=n(7265),c=n(2909);async function l(t,e){const{currentInstance:n,accessToken:l}=i.h.get();i.h.set({uploadingMedia:!0});try{const s=await(0,o.$)(n,l,e),a=i.h.getComposeData(t,"media")||[];if(4===a.length)throw new Error("Only 4 media max are allowed");await c.F.setCachedMediaFile(s.id,e),a.push({data:s,file:{name:e.name},description:""}),i.h.setComposeData(t,{media:a}),(0,r.F)((()=>i.h.save()))}catch(u){console.error(u),s.A.say((0,a.A)(["Failed to upload media: ",["error"]],{error:u.message||""}))}finally{i.h.set({uploadingMedia:!1})}}function u(t,e){const n=i.h.getComposeData(t,"media");if(n.splice(e,1),i.h.setComposeData(t,{media:n}),!n.length){const e=i.h.getComposeData(t,"contentWarningShown"),n=i.h.getComposeData(t,"contentWarning");i.h.setComposeData(t,{sensitive:e&&n})}(0,r.F)((()=>i.h.save()))}},825:(t,e,n)=>{"use strict";n.d(e,{$:()=>s,_:()=>r});var i=n(1029),o=n(8273);async function s(t,e,n,s){const r=new FormData;r.append("file",n),s&&r.append("description",s);const a=`${(0,i.E)(t)}/api/v1/media`;return(0,o.v_)(a,r,(0,i.I)(e),{timeout:o.HZ})}async function r(t,e,n,s,r){const a=`${(0,i.E)(t)}/api/v1/media/${n}`;return(0,o.gz)(a,{description:s,focus:r&&r.join(",")},(0,i.I)(e),{timeout:o.$Q})}},2909:(t,e,n)=>{"use strict";n.d(e,{F:()=>i});const i=new Proxy({},{get:function(t,e){return async function(...i){if(!t[e]){const i=await Promise.all([n.e(3881),n.e(166)]).then(n.bind(n,166));t[e]=i[e]}return t[e].apply(null,i)}}})},3006:(t,e,n)=>{"use strict";function i(t,e,n){let i=0,o=0;const s=[];for(;i<t.length||o<e.length;){if(i===t.length){s.push(e[o]),o++;continue}if(o===e.length){s.push(t[i]),i++;continue}const r=t[i],a=e[o],c=n(a,r);0===c?(s.push(r),o++,i++):c>0?(s.push(a),o++):(s.push(r),i++)}return s}function o(){let t=[];for(let e=0,n=arguments.length;e<n;e++){const n=arguments[e];Array.isArray(n)?t=t.concat(arguments[e]):t.push(arguments[e])}return t}n.d(e,{e:()=>i,z:()=>o})},5918:(t,e,n)=>{"use strict";let i;n.d(e,{b:()=>o});function o(t,e){if(!e||!Object.keys(e).length)return;const n=(t=>{const e=t.status||t,n=e.reblog||e;i=i||new DOMParser;const o=[n.spoiler_text||"",n.content].concat(n.poll&&n.poll.options?n.poll.options.map((t=>t.title)):[]).join("\n\n").replace(/<br\s*\/?>/g,"\n").replace(/<\/p><p>/g,"\n\n");return i.parseFromString(o,"text/html").documentElement.textContent})(t),o=Object.entries(e).filter((([t,e])=>e.test(n))).map((([t])=>t));return o.length?o:void 0}},3242:(t,e,n)=>{"use strict";async function i(t,e,n,i){const o=t();let s;try{s=await e()}catch(r){console.error("ignored DB error",r)}finally{s&&i(s);const t=o.then((t=>{n(t),i(t)}));s||await t}}async function o(t,e,n,i){let o;try{o=await e()}catch(s){console.error("ignored DB error",s)}if(o)i(o);else{const e=await t();n(e),i(e)}}n.d(e,{u:()=>i,o:()=>o})},8657:(t,e,n)=>{"use strict";n.d(e,{o:()=>r});var i=n(5918),o=n(2936);class s{constructor(t,e){this.id=t.id,this.accountId=t.account.id,this.replyId=t.in_reply_to_id||void 0,this.reblogId=t.reblog&&t.reblog.id||void 0,this.type=t.type||void 0;const{unexpiredInstanceFilterRegexes:n}=o.h.get(),s=n[e];this.filterContexts=(0,i.b)(t,s)}}function r(t,e){return new s(t,e)}}}]);
//# sourceMappingURL=2943.d92a2651b5d516a69f9d.2943.js.map