(this.webpackChunkpinafore=this.webpackChunkpinafore||[]).push([[8651],{1672:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>S});var s=n(4178),a=n(2905),r=n(1382),o=n(2936),i=n(9054),c=n(3256),l=n(8267),h=n(9742),d=n(7706),f=n(2311),u=n(6084),g=n(8369),m=n(7265);var p={onSwitchToThisInstance(t,e){t.preventDefault(),t.stopPropagation(),(0,i.rd)(e)}};function I(t,e,n){const s=Object.create(t);return s.instance=e[n],s}function _(t,e){var n,a,r,o,i,c,l;return{c(){n=(0,s.az)("p"),a=(0,s.rw)("You're not logged in to any instances."),r=(0,s.rw)("\n    "),o=(0,s.az)("p"),i=(0,s.az)("a"),c=(0,s.rw)("Log in to an instance"),l=(0,s.rw)("\n      to start using Pinafore."),this.h()},l(t){n=(0,s.d$)(t,"P",{},!1);var e=(0,s.pI)(n);a=(0,s.M4)(e,"You're not logged in to any instances."),e.forEach(s.r2),r=(0,s.M4)(t,"\n    "),o=(0,s.d$)(t,"P",{},!1);var h=(0,s.pI)(o);i=(0,s.d$)(h,"A",{rel:!0,href:!0,id:!0},!1);var d=(0,s.pI)(i);c=(0,s.M4)(d,"Log in to an instance"),d.forEach(s.r2),l=(0,s.M4)(h,"\n      to start using Pinafore."),h.forEach(s.r2),this.h()},h(){i.rel="prefetch",i.href="/settings/instances/add",i.id="log-in-link-2"},m(t,e){(0,s.$T)(t,n,e),(0,s.R3)(n,a),(0,s.$T)(t,r,e),(0,s.$T)(t,o,e),(0,s.R3)(o,i),(0,s.R3)(i,c),(0,s.R3)(o,l)},p:s.ZT,d(t){t&&((0,s.r2)(n),(0,s.r2)(r),(0,s.r2)(o))}}}function v(t,e){for(var n,a,r,o,i,c,h,d,f=e.instanceStates,g=[],m=0;m<f.length;m+=1)g[m]=w(t,I(e,f,m));var p=new l.Z({root:t.root,store:t.store,slots:{default:(0,s.xJ)()},data:{label:"Instances"}}),_={id:"instance-switch",label:"Switch to instance",length:e.numInstances},v=new u.Z({root:t.root,store:t.store,slots:{default:(0,s.xJ)()},data:_});return{c(){n=(0,s.az)("p"),a=(0,s.rw)("Instances you've logged in to:"),r=(0,s.rw)("\n    ");for(var t=0;t<g.length;t+=1)g[t].c();o=(0,s.Yr)(),p._fragment.c(),v._fragment.c(),i=(0,s.rw)("\n    "),c=(0,s.az)("p"),h=(0,s.az)("a"),d=(0,s.rw)("Add another instance"),this.h()},l(t){n=(0,s.d$)(t,"P",{},!1);var e=(0,s.pI)(n);a=(0,s.M4)(e,"Instances you've logged in to:"),e.forEach(s.r2),r=(0,s.M4)(t,"\n    ");for(var l=0;l<g.length;l+=1)g[l].l(t);o=(0,s.Yr)(),p._fragment.l(t),v._fragment.l(t),i=(0,s.M4)(t,"\n    "),c=(0,s.d$)(t,"P",{},!1);var f=(0,s.pI)(c);h=(0,s.d$)(f,"A",{rel:!0,href:!0,id:!0},!1);var u=(0,s.pI)(h);d=(0,s.M4)(u,"Add another instance"),u.forEach(s.r2),f.forEach(s.r2),this.h()},h(){h.rel="prefetch",h.href="/settings/instances/add",h.id="log-in-link-1"},m(t,e){(0,s.$T)(t,n,e),(0,s.R3)(n,a),(0,s.$T)(t,r,e);for(var l=0;l<g.length;l+=1)g[l].m(p._slotted.default,null);(0,s.R3)(p._slotted.default,o),p._mount(v._slotted.default,null),v._mount(t,e),(0,s.$T)(t,i,e),(0,s.$T)(t,c,e),(0,s.R3)(c,h),(0,s.R3)(h,d)},p(e,n){if(e.instanceStates){f=n.instanceStates;for(var s=0;s<f.length;s+=1){const a=I(n,f,s);g[s]?g[s].p(e,a):(g[s]=w(t,a),g[s].c(),g[s].m(o.parentNode,o))}for(;s<g.length;s+=1)g[s].d(1);g.length=f.length}var a={};e.numInstances&&(a.length=n.numInstances),v._set(a)},d(t){t&&((0,s.r2)(n),(0,s.r2)(r)),(0,s.kw)(g,t),p.destroy(),v.destroy(t),t&&((0,s.r2)(i),(0,s.r2)(c))}}}function w(t,e){var n,a,r={className:"instance-switcher-instance-name",href:"/settings/instances/"+e.instance.name,label:e.instance.name,ariaLabel:e.instance.label},o=new d.Z({root:t.root,store:t.store,data:r}),i={className:"instance-switcher-button-svg",href:e.instance.current?"#fa-star":"#fa-star-o"},c=new f.Z({root:t.root,store:t.store,data:i}),l={id:"instance-switch",className:"instance-switcher-button",label:e.instance.switchLabel,checked:e.instance.current,index:e.instance.index},u=new g.Z({root:t.root,store:t.store,slots:{default:(0,s.xJ)()},data:l});u.on("click",(function(n){t.onSwitchToThisInstance(n,e.instance.name)}));var m=new h.Z({root:t.root,store:t.store,slots:{default:(0,s.xJ)()}});return{c(){o._fragment.c(),n=(0,s.rw)("\n          "),a=(0,s.az)("div"),c._fragment.c(),u._fragment.c(),m._fragment.c(),this.h()},l(t){o._fragment.l(t),n=(0,s.M4)(t,"\n          "),a=(0,s.d$)(t,"DIV",{class:!0},!1);var e=(0,s.pI)(a);c._fragment.l(t),u._fragment.l(e),e.forEach(s.r2),m._fragment.l(t),this.h()},h(){a.className="instance-switcher-button-wrapper svelte-16f9mrq"},m(t,e){o._mount(m._slotted.default,null),(0,s.R3)(m._slotted.default,n),(0,s.R3)(m._slotted.default,a),c._mount(u._slotted.default,null),u._mount(a,null),m._mount(t,e)},p(t,n){e=n;var s={};t.instanceStates&&(s.href="/settings/instances/"+e.instance.name),t.instanceStates&&(s.label=e.instance.name),t.instanceStates&&(s.ariaLabel=e.instance.label),o._set(s);var a={};t.instanceStates&&(a.href=e.instance.current?"#fa-star":"#fa-star-o"),c._set(a);var r={};t.instanceStates&&(r.label=e.instance.switchLabel),t.instanceStates&&(r.checked=e.instance.current),t.instanceStates&&(r.index=e.instance.index),u._set(r)},d(t){o.destroy(),c.destroy(),u.destroy(),m.destroy(t)}}}function y(t){var e;if((0,s.S1)(this,t),this.store=o.h,this._state=(0,s.f0)(this.store._init(["loggedInInstancesAsList","isUserLoggedIn"]),t.data),this.store._add(this,["loggedInInstancesAsList","isUserLoggedIn"]),this._recompute({$loggedInInstancesAsList:1},this._state),this._intro=!0,this._handlers.destroy=[s.iT],document.getElementById("svelte-16f9mrq-style")||((e=(0,s.az)("style")).id="svelte-16f9mrq-style",e.textContent=".instance-switcher-instance-name{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.instance-switcher-button-wrapper.svelte-16f9mrq{position:relative;border:1px solid var(--settings-list-item-border);min-width:44px}.instance-switcher-button{display:flex;position:absolute;top:0;left:0;bottom:0;right:0;width:100%;border:none;background:none;align-items:center;justify-content:center;margin:1px}.instance-switcher-button-svg{width:24px;height:24px;display:inline-block;fill:var(--svg-fill)}",(0,s.R3)(document.head,e)),this._fragment=function(t,e){var n,a,r,o;function i(t){return t.$isUserLoggedIn?v:_}var l=i(e),h=l(t,e),d=new c.Z({root:t.root,store:t.store,slots:{default:(0,s.xJ)()},data:{page:"settings/instances",label:"Instances"}});return{c(){n=(0,s.az)("h1"),a=(0,s.rw)("Instances"),r=(0,s.rw)("\n\n  "),h.c(),o=(0,s.Yr)(),d._fragment.c()},l(t){n=(0,s.d$)(t,"H1",{},!1);var e=(0,s.pI)(n);a=(0,s.M4)(e,"Instances"),e.forEach(s.r2),r=(0,s.M4)(t,"\n\n  "),h.l(t),o=(0,s.Yr)(),d._fragment.l(t)},m(t,e){(0,s.R3)(d._slotted.default,n),(0,s.R3)(n,a),(0,s.R3)(d._slotted.default,r),h.m(d._slotted.default,null),(0,s.R3)(d._slotted.default,o),d._mount(t,e)},p(e,n){l===(l=i(n))&&h?h.p(e,n):(h.d(1),(h=l(t,n)).c(),h.m(o.parentNode,o))},d(t){h.d(),d.destroy(t)}}}(this,this._state),t.target){var n=(0,s.pI)(t.target);t.hydrate?this._fragment.l(n):this._fragment.c(),n.forEach(s.r2),this._mount(t.target,t.anchor),(0,s.yl)(this)}}(0,s.f0)(y.prototype,s.uS),(0,s.f0)(y.prototype,p),y.prototype._recompute=function(t,e){t.$loggedInInstancesAsList&&(this._differs(e.instanceStates,e.instanceStates=function({$loggedInInstancesAsList:t}){return t.map((({name:t,current:e},n)=>({index:n,name:t,current:e,label:(0,m.A)([["instance"]," ",["current","select",{true:["(current instance)"],other:[]}]],{instance:t,current:e}),switchLabel:(0,m.A)(["Switch to ",["instance"]],{instance:t})})))}(e))&&(t.instanceStates=!0),this._differs(e.numInstances,e.numInstances=function({$loggedInInstancesAsList:t}){return t.length}(e))&&(t.numInstances=!0))};const b=y;function $(t){var e,n,o,i,c,l;if((0,s.S1)(this,t),this._state=(0,s.f0)({pageComponent:b},t.data),this._intro=!0,this._fragment=(e=this,n=this._state,i=new a.Z({root:e.root,store:e.store,data:{name:"Instances",settingsPage:!0}}),c={pageComponent:n.pageComponent,params:n.params},l=new r.Z({root:e.root,store:e.store,data:c}),{c(){i._fragment.c(),o=(0,s.rw)("\n\n  "),l._fragment.c()},l(t){i._fragment.l(t),o=(0,s.M4)(t,"\n\n  "),l._fragment.l(t)},m(t,e){i._mount(t,e),(0,s.$T)(t,o,e),l._mount(t,e)},p(t,e){var n={};t.pageComponent&&(n.pageComponent=e.pageComponent),t.params&&(n.params=e.params),l._set(n)},d(t){i.destroy(t),t&&(0,s.r2)(o),l.destroy(t)}}),t.target){var h=(0,s.pI)(t.target);t.hydrate?this._fragment.l(h):this._fragment.c(),h.forEach(s.r2),this._mount(t.target,t.anchor),(0,s.yl)(this)}}(0,s.f0)($.prototype,s.uS);const S=$},9054:(t,e,n)=>{"use strict";n.d(e,{Lr:()=>f,jh:()=>g,rd:()=>u,Q:()=>p,Ac:()=>m});var s=n(4511),a=n(2936),r=n(3734),o=n(6494),i=n(8313),c=n(3242),l=n(1281),h=n(2909);var d=n(7265);function f(t,e){const{instanceThemes:n}=a.h.get();n[t]=e,a.h.set({instanceThemes:n}),a.h.save();const{currentInstance:s}=a.h.get();if(t===s){const{enableGrayscale:t}=a.h.get();(0,r.Xi)(e,t)}}function u(t){const{instanceThemes:e}=a.h.get();a.h.set({currentInstance:t,searchResults:null,queryInSearch:""}),a.h.save();const{enableGrayscale:n}=a.h.get();(0,r.Xi)(e[t],n)}async function g(t,e){e=e||(0,d.A)(["Logged out of ",["instance"]],{instance:t});const{composeData:s,currentInstance:c,customEmoji:l,instanceInfos:f,instanceLists:u,instanceThemes:g,loggedInInstances:m,loggedInInstancesInOrder:p,verifyCredentials:I}=a.h.get();p.splice(p.indexOf(t),1);const _=t===c?p[0]:c,v=[s,l,f,u,g,m,I];for(const n of v)delete n[t];a.h.set({composeData:s,currentInstance:_,customEmoji:l,instanceInfos:f,instanceLists:u,instanceThemes:g,loggedInInstances:m,loggedInInstancesInOrder:p,queryInSearch:"",searchResults:null,timelineInitialized:!1,timelinePreinitialized:!1,verifyCredentials:I}),a.h.clearTimelineDataForInstance(t),a.h.clearAutosuggestDataForInstance(t),a.h.save();const{virtualListStore:w}=await Promise.all([n.e(9921),n.e(1257),n.e(1089)]).then(n.bind(n,1257));w.clearRealmByPrefix(c+"/"),o.A.say(e);const{enableGrayscale:y}=a.h.get();(0,r.Xi)(g[_],y),h.F.clearDatabaseForInstance(t),(0,i.E9)("/settings/instances")}async function m(t){const{loggedInInstances:e}=a.h.get(),n=e[t].access_token;await(0,c.u)((()=>(0,s.Q)(t,n).catch(function(t){return async e=>{throw e.message.startsWith("401:")&&await g(t,(0,d.A)(["The access token was revoked, logged out of ",["instance"]],{instance:t})),e}}(t))),(()=>h.F.getInstanceVerifyCredentials(t)),(e=>h.F.setInstanceVerifyCredentials(t,e)),(e=>function(t,e){const{verifyCredentials:n}=a.h.get();n[t]=e,a.h.set({verifyCredentials:n})}(t,e)))}async function p(t){await(0,c.u)((()=>(0,l.s)(t)),(()=>h.F.getInstanceInfo(t)),(e=>h.F.setInstanceInfo(t,e)),(e=>{const{instanceInfos:n}=a.h.get();n[t]=e,a.h.set({instanceInfos:n})}))}},1281:(t,e,n)=>{"use strict";n.d(e,{s:()=>r});var s=n(8273),a=n(1029);function r(t){const e=`${(0,a.E)(t)}/api/v1/instance`;return(0,s.U2)(e,null,{timeout:s.EH})}},4511:(t,e,n)=>{"use strict";n.d(e,{Q:()=>r,D:()=>o});var s=n(8273),a=n(1029);function r(t,e){const n=`${(0,a.E)(t)}/api/v1/accounts/verify_credentials`;return(0,s.U2)(n,(0,a.I)(e),{timeout:s.EH})}function o(t,e,n){const r=`${(0,a.E)(t)}/api/v1/accounts/${n}`;return(0,s.U2)(r,(0,a.I)(e),{timeout:s.EH})}}}]);
//# sourceMappingURL=8651.c6cc5a6cbc2b64195631.settings_instances.js.map