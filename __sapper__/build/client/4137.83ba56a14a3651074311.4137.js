(this.webpackChunkpinafore=this.webpackChunkpinafore||[]).push([[4137,6077],{6389:(t,e,n)=>{"use strict";n.d(e,{d:()=>l});var s=n(2909);var i=n(2936),o=n(9921),a=n(2846);function r(t,e,n){const s=t=>n(t.id);["timelineItemSummaries","timelineItemSummariesToAdd"].forEach((n=>{const a=i.h.getAllTimelineData(t,n);Object.keys(a).forEach((r=>{const c=a[r];if(!e(r))return;const u=c.filter(s);(0,o.Z)(c,u)||i.h.setForTimeline(t,r,{[n]:u})}))}))}async function c(t,e,n){!function(t,e){const n=new Set(e);r(t,(t=>"notifications"!==t),(t=>!n.has(t)))}(t,e),function(t,e){const n=new Set(e);r(t,(t=>"notifications"===t),(t=>!n.has(t)))}(t,n),await s.F.deleteStatusesAndNotifications(t,e,n)}async function u(t,e){const n=await async function(t,e){return s.F.getReblogsForStatus(t,e)}(t,e),i=Array.from(new Set([e].concat(n).filter(Boolean))),o=Array.from(new Set(await async function(t,e){return s.F.getNotificationIdsForStatuses(t,e)}(t,i)));await c(t,i,o)}function l(t,e){(0,a.F)((()=>{u(t,e)}))}},3592:(t,e,n)=>{"use strict";n.d(e,{Z:()=>c});var s=n(2936),i=n(3242),o=n(2909),a=n(5853),r=n(6826);async function c(t){const{verifyCredentials:e,loggedInInstances:n}=s.h.get();if(!(0,r.U2)(e,[t,"locked"]))return;const c=n[t].access_token;await(0,i.u)((async()=>(await(0,a._v)(t,c)).length),(()=>o.F.getFollowRequestCount(t)),(e=>o.F.setFollowRequestCount(t,e)),(e=>{const{followRequestCounts:n}=s.h.get();n[t]=e,s.h.set({followRequestCounts:n})}))}},9054:(t,e,n)=>{"use strict";n.d(e,{Lr:()=>m,jh:()=>g,rd:()=>f,Q:()=>p,Ac:()=>d});var s=n(4511),i=n(2936),o=n(3734),a=n(6494),r=n(8313),c=n(3242),u=n(1281),l=n(2909);var h=n(7265);function m(t,e){const{instanceThemes:n}=i.h.get();n[t]=e,i.h.set({instanceThemes:n}),i.h.save();const{currentInstance:s}=i.h.get();if(t===s){const{enableGrayscale:t}=i.h.get();(0,o.Xi)(e,t)}}function f(t){const{instanceThemes:e}=i.h.get();i.h.set({currentInstance:t,searchResults:null,queryInSearch:""}),i.h.save();const{enableGrayscale:n}=i.h.get();(0,o.Xi)(e[t],n)}async function g(t,e){e=e||(0,h.A)(["Logged out of ",["instance"]],{instance:t});const{composeData:s,currentInstance:c,customEmoji:u,instanceInfos:m,instanceLists:f,instanceThemes:g,loggedInInstances:d,loggedInInstancesInOrder:p,verifyCredentials:w}=i.h.get();p.splice(p.indexOf(t),1);const y=t===c?p[0]:c,S=[s,u,m,f,g,d,w];for(const n of S)delete n[t];i.h.set({composeData:s,currentInstance:y,customEmoji:u,instanceInfos:m,instanceLists:f,instanceThemes:g,loggedInInstances:d,loggedInInstancesInOrder:p,queryInSearch:"",searchResults:null,timelineInitialized:!1,timelinePreinitialized:!1,verifyCredentials:w}),i.h.clearTimelineDataForInstance(t),i.h.clearAutosuggestDataForInstance(t),i.h.save();const{virtualListStore:v}=await Promise.all([n.e(9921),n.e(1257),n.e(1089)]).then(n.bind(n,1257));v.clearRealmByPrefix(c+"/"),a.A.say(e);const{enableGrayscale:I}=i.h.get();(0,o.Xi)(g[y],I),l.F.clearDatabaseForInstance(t),(0,r.E9)("/settings/instances")}async function d(t){const{loggedInInstances:e}=i.h.get(),n=e[t].access_token;await(0,c.u)((()=>(0,s.Q)(t,n).catch(function(t){return async e=>{throw e.message.startsWith("401:")&&await g(t,(0,h.A)(["The access token was revoked, logged out of ",["instance"]],{instance:t})),e}}(t))),(()=>l.F.getInstanceVerifyCredentials(t)),(e=>l.F.setInstanceVerifyCredentials(t,e)),(e=>function(t,e){const{verifyCredentials:n}=i.h.get();n[t]=e,i.h.set({verifyCredentials:n})}(t,e)))}async function p(t){await(0,c.u)((()=>(0,u.s)(t)),(()=>l.F.getInstanceInfo(t)),(e=>l.F.setInstanceInfo(t,e)),(e=>{const{instanceInfos:n}=i.h.get();n[t]=e,i.h.set({instanceInfos:n})}))}},6161:(t,e,n)=>{"use strict";n.d(e,{L:()=>l,R:()=>u});var s=n(2936),i=n(8273),o=n(1029);var a=n(3242),r=n(2909);async function c(t,e){const{loggedInInstances:n}=s.h.get(),a=n[t].access_token;await e((()=>function(t,e){const n=`${(0,o.E)(t)}/api/v1/lists`;return(0,i.U2)(n,(0,o.I)(e),{timeout:i.EH})}(t,a)),(()=>r.F.getLists(t)),(e=>r.F.setLists(t,e)),(e=>{const{instanceLists:n}=s.h.get();n[t]=e,s.h.set({instanceLists:n})}))}async function u(t){await c(t,a.u)}async function l(t){await c(t,a.o)}},5853:(t,e,n)=>{"use strict";n.d(e,{_v:()=>o});var s=n(8273),i=n(1029);async function o(t,e){const n=`${(0,i.E)(t)}/api/v1/follow_requests`;return(0,s.U2)(n,(0,i.I)(e),{timeout:s.EH})}},1281:(t,e,n)=>{"use strict";n.d(e,{s:()=>o});var s=n(8273),i=n(1029);function o(t){const e=`${(0,i.E)(t)}/api/v1/instance`;return(0,s.U2)(e,null,{timeout:s.EH})}},6172:(t,e,n)=>{"use strict";n.d(e,{y:()=>a});var s=n(8273),i=n(1029);function o(t,e,n,o,a,r,c,u){const l=`${(0,i.E)(e)}/api/${t}/search?`+(0,s.pe)({q:o,resolve:a,limit:r,exclude_unreviewed:!!c});return(0,s.U2)(l,(0,i.I)(n),{timeout:s.EH,signal:u})}async function a(t,e,n,s=!0,a=5,r=!1,c=null){try{return await async function(t,e,n,s,i,a,r){return o("v2",t,e,n,s,i,a,r)}(t,e,n,s,a,r,c)}catch(u){if(u&&404===u.status)return async function(t,e,n,s,a,r,c){const u=await o("v1",t,e,n,s,a,r,c);return u.hashtags=u.hashtags&&u.hashtags.map((e=>({name:e,url:`${(0,i.E)(t)}/tags/${e.toLowerCase()}`,history:[]}))),u}(t,e,n,s,a,r,c);throw u}}},7526:(t,e,n)=>{"use strict";n.d(e,{V:()=>o});var s=n(8273),i=n(1029);async function o(t,e,n,o,a,r){const c=function(t){switch(t){case"local":case"federated":return"timelines/public";case"home":return"timelines/home";case"notifications":case"notifications/mentions":return"notifications";case"favorites":return"favourites";case"direct":return"conversations";case"bookmarks":return"bookmarks"}if(t.startsWith("tag/"))return"timelines/tag";if(t.startsWith("account/"))return"accounts";if(t.startsWith("list/"))return"timelines/list";throw new Error(`Invalid timeline type: ${t}`)}(n);let u=`${(0,i.E)(t)}/api/v1/${c}`;n.startsWith("tag/")?u+="/"+n.split("/")[1]:n.startsWith("account/")?u+="/"+n.split("/")[1]+"/statuses":n.startsWith("list/")&&(u+="/"+n.split("/")[1]);const l={};a&&(l.since_id=a),o&&(l.max_id=o),r&&(l.limit=r),"local"===n&&(l.local=!0),n.startsWith("account/")&&(n.endsWith("media")?l.only_media=!0:l.exclude_replies=!n.endsWith("/with_replies")),"notifications/mentions"===n&&(l.exclude_types=["follow","favourite","reblog","poll"]),u+="?"+(0,s.pe)(l);let{json:h,headers:m}=await(0,s.SM)(u,(0,i.I)(e),{timeout:s.EH});return"direct"===n&&(h=h.map((t=>t.last_status))),{items:h,headers:m}}},4511:(t,e,n)=>{"use strict";n.d(e,{Q:()=>o,D:()=>a});var s=n(8273),i=n(1029);function o(t,e){const n=`${(0,i.E)(t)}/api/v1/accounts/verify_credentials`;return(0,s.U2)(n,(0,i.I)(e),{timeout:s.EH})}function a(t,e,n){const o=`${(0,i.E)(t)}/api/v1/accounts/${n}`;return(0,s.U2)(o,(0,i.I)(e),{timeout:s.EH})}},1029:(t,e,n)=>{"use strict";function s(t){return function(t){return t.startsWith("localhost:")||t.startsWith("127.0.0.1:")}(t)?`http://${t}`:`https://${t}`}function i(t){return{Authorization:`Bearer ${t}`}}n.d(e,{E:()=>s,I:()=>i})},6077:(t,e,n)=>{"use strict";n.d(e,{B:()=>s});const s=()=>Promise.all([n.e(8322),n.e(9921),n.e(1632),n.e(2392),n.e(7500),n.e(5451),n.e(7608),n.e(2943),n.e(4736),n.e(6905),n.e(8967)]).then(n.bind(n,8967)).then((t=>t.default))},8513:(t,e,n)=>{"use strict";n.d(e,{f:()=>s,P:()=>i});const s=432e6,i=3e5},4963:(t,e,n)=>{"use strict";n.d(e,{jN:()=>i,Ay:()=>o,FO:()=>a});var s=n(8514);const i=`/emoji-${s.M}.json`,o=void 0,a="en-US"===s.M?"en":s.M},7394:(t,e,n)=>{"use strict";n.d(e,{Ny:()=>s,zW:()=>i,wM:()=>o,IO:()=>a,aO:()=>r,j6:()=>c,lG:()=>u,_s:()=>l});const s="home",i="notifications",o="public",a="thread",r="account",c=[s,i,o,a,r],u=[{value:0,label:"Never"},{value:1800,label:"30 minutes"},{value:3600,label:"1 hour"},{value:21600,label:"6 hours"},{value:43200,label:"12 hours"},{value:86400,label:"1 day"},{value:604800,label:"7 days"}],l=0},4137:(t,e,n)=>{"use strict";n.r(e);var s=n(6826);function i(t){return t&&t[0]&&t[0].id}var o=n(7569);function a(t,e,n){t.compute(e,["currentInstance","currentTimeline",`timelineData_${e}`],((t,e,i)=>(0,s.U2)(i,[t,e],n)))}const r=new RegExp("(?:\\s|^)((?:@|:|#)[\\w\\+_\\-:]{2,})$");function c(t,e,n){t.compute(e,["currentInstance","currentComposeRealm",`autosuggestData_${e}`],((t,e,i)=>(0,s.U2)(i,[t,e],n)))}var u=n(2936);var l=n(7394);function h(t){t.compute("currentFilters",["unexpiredInstanceFilters","currentInstance"],((t,e)=>t[e]||[])),t.compute("unexpiredInstanceFilterRegexes",["unexpiredInstanceFilters"],(t=>Object.fromEntries(Object.entries(t).map((([t,e])=>[t,Object.fromEntries(l.j6.map((t=>{const n=e.filter((e=>e.context.includes(t)));if(!n.length)return;const s=(t=>new RegExp(t.map((t=>{let e=t.phrase.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return t.whole_word&&(/^[\w]/.test(e)&&(e=`\\b${e}`),/[\w]$/.test(e)&&(e=`${e}\\b`)),e})).join("|"),"i"))(n);return[t,s]})).filter(Boolean))])))))}var m=n(5376);const f=(t,e,n,s,i,o,a)=>r=>{if(r.filterContexts&&r.filterContexts.includes(a))return!1;switch(r.type){case"poll":return o;case"favourite":return s;case"reblog":return t;case"mention":return i;case"follow":return n}return r.reblogId?t:!r.replyId||e};function g(t,e,n){t.compute(e,["currentInstance","instanceSettings","currentTimeline"],((t,e,i)=>{const o=n[i];return!o||(0,s.U2)(e,[t,o],!0)}))}function d(t,e,n){t.compute(e,["currentInstance","instanceSettings"],((t,e)=>(0,s.U2)(e,[t,n],!0)))}var p=n(9054),w=n(6161);class y{constructor(t){this.attempts=0,this.onReady=t}backoff(){const t=this.fibonacci(++this.attempts);setTimeout(this.onReady,t)}fibonacci(t){let e=1;if(t>e){let n=1;e=2;for(let s=2;s<t;s++){const t=n+e;n=e,e=t}}return Math.min(6e4,Math.floor(Math.random()*e*100))}reset(){this.attempts=0}}class S{constructor(t,e=null,n={}){this.url=t,this.protocols=e,this.reconnectEnabled=!0,this.listeners={},this.backoff=new y(this.onBackoffReady.bind(this)),(void 0===n.connect||n.connect)&&this.open()}open(t=!1){this.isReconnect=t;const e=this.ws&&this.ws.binaryType;this.ws=new WebSocket(this.url,this.protocols),this.ws.onclose=this.onCloseCallback.bind(this),this.ws.onerror=this.onErrorCallback.bind(this),this.ws.onmessage=this.onMessageCallback.bind(this),this.ws.onopen=this.onOpenCallback.bind(this),e&&(this.ws.binaryType=e)}onBackoffReady(){this.open(!0)}onCloseCallback(t){!this.isReconnect&&this.listeners.onclose&&this.listeners.onclose.apply(null,arguments),this.reconnectEnabled&&t.code<3e3&&this.backoff.backoff()}onErrorCallback(){this.listeners.onerror&&this.listeners.onerror.apply(null,arguments)}onMessageCallback(){this.listeners.onmessage&&this.listeners.onmessage.apply(null,arguments)}onOpenCallback(){this.listeners.onopen&&this.listeners.onopen.apply(null,arguments),this.isReconnect&&this.listeners.onreconnect&&this.listeners.onreconnect.apply(null,arguments),this.isReconnect=!1}get readyState(){return this.ws.readyState}close(t,e){void 0===t&&(t=1e3),this.reconnectEnabled=!1,this.ws.close(t,e)}send(t){this.ws.send(t)}set onclose(t){this.listeners.onclose=t}get onclose(){return this.listeners.onclose}set onerror(t){this.listeners.onerror=t}get onerror(){return this.listeners.onerror}set onmessage(t){this.listeners.onmessage=t}get onmessage(){return this.listeners.onmessage}set onopen(t){this.listeners.onopen=t}get onopen(){return this.listeners.onopen}set onreconnect(t){this.listeners.onreconnect=t}get onreconnect(){return this.listeners.onreconnect}reset(){this.backoff.reset()}reconnect(){this.onBackoffReady()}}S.CONNECTING=WebSocket.CONNECTING,S.OPEN=WebSocket.OPEN,S.CLOSING=WebSocket.CLOSING,S.CLOSED=WebSocket.CLOSED;var v=n(673),I=n(8273);var b=n(9749),_=n(652),F=n(6621);class C extends b.EventEmitter{constructor(t,e,n){super(),this._streamingApi=t,this._accessToken=e,this._timeline=n,this._onStateChange=this._onStateChange.bind(this),this._onOnline=this._onOnline.bind(this),this._onOffline=this._onOffline.bind(this),this._onForcedOnlineStateChange=this._onForcedOnlineStateChange.bind(this),this._setupWebSocket(),this._setupEvents()}close(){this._closed=!0,this._closeWebSocket(),this._teardownEvents();for(const t of["open","close","reconnect","message"])this.removeAllListeners(t)}_closeWebSocket(){this._ws&&(this.emit("close"),this._ws.onopen=null,this._ws.onmessage=null,this._ws.onclose=null,this._ws.close(),this._ws=null)}_setupWebSocket(){const t=function(t,e,n){const s=`${t}/api/v1/streaming`,i={stream:function(t){switch(t){case"local":return"public:local";case"federated":return"public";case"home":return"user";case"notifications":return"user:notification";case"direct":return"direct"}return t.startsWith("tag/")?"hashtag":t.startsWith("list/")?"list":void 0}(n)};return n.startsWith("tag/")?i.tag=n.split("/").slice(-1)[0]:n.startsWith("list/")&&(i.list=n.split("/").slice(-1)[0]),e&&(i.access_token=e),s+"?"+(0,I.pe)(i)}(this._streamingApi,this._accessToken,this._timeline),e=new S(t);e.onopen=()=>{this._opened?this.emit("reconnect"):(this.emit("open"),this._opened=!0)},e.onmessage=t=>this.emit("message",(0,F.A)(t.data)),e.onclose=()=>this.emit("close"),this._ws=e}_setupEvents(){v.S.addEventListener("statechange",this._onStateChange),_.Y.on("forcedOnline",this._onForcedOnlineStateChange),window.addEventListener("online",this._onOnline),window.addEventListener("offline",this._onOffline)}_teardownEvents(){v.S.removeEventListener("statechange",this._onStateChange),_.Y.removeListener("forcedOnline",this._onForcedOnlineStateChange),window.removeEventListener("online",this._onOnline),window.removeEventListener("offline",this._onOffline)}_pause(){this._closed||this._closeWebSocket()}_unpause(){this._closed||(this._closeWebSocket(),this._setupWebSocket())}_onStateChange(t){"frozen"===t.newState?this._pause():"frozen"===t.oldState&&this._unpause(),"active"===t.newState&&this._tryToReconnect()}_onOnline(){this._unpause(),this._tryToReconnect()}_onOffline(){this._pause()}_onForcedOnlineStateChange(t){t?this._unpause():this._pause()}_tryToReconnect(){this._ws&&this._ws.readyState,this._ws&&this._ws.readyState!==S.OPEN&&(this._ws.reset(),this._ws.reconnect())}}var T=n(6389),E=n(1786);const k=["update","delete","notification","conversation","filters_changed"];var O=n(7526);function A(t,e,n,s,i,a){const r=(t,s)=>{s&&async function(t,e,n,s){let i,o=null,a=0;do{a++,i=(await(0,O.V)(t,e,n,o,s,20)).items,i.length&&((0,E.b)(t,n,i),o=i[i.length-1].id)}while(a<15&&20===i.length)}(e,n,t,s)};return new C(t,n,s).on("message",(t=>{!function(t,e,n){let{event:s,payload:i}=n||{};if(k.includes(s)){switch((0,o.B)("processMessage"),["update","notification","conversation"].includes(s)&&(i=JSON.parse(i)),s){case"delete":(0,T.d)(t,i);break;case"update":(0,E.I)(t,e,i);break;case"notification":(0,E.I)(t,"notifications",i),"mention"===i.type&&(0,E.I)(t,"notifications/mentions",i);break;case"conversation":(0,E.I)(t,e,i.last_status);break;case"filters_changed":(0,_.j)("wordFiltersChanged",t)}(0,o.s)("processMessage")}else console.warn("ignoring message from server",n)}(e,s,t)})).on("open",(()=>{r(s,i),"home"===s&&r("notifications",a)})).on("close",(()=>{})).on("reconnect",(()=>{const t=u.h.getFirstTimelineItemId(e,s);if(r(s,t),"home"===s){const t=u.h.getFirstTimelineItemId(e,"notifications");r("notifications",t)}}))}var R=n(4585),x=n(1312),D=n(2846),j=n(3592),N=n(1787);let W;async function $(t,e){(0,o.B)(`refreshInstanceDataAndStream-${e}`),await async function(t,e){if(P(t,e))return;if(await async function(t){(0,D.F)((()=>(0,x.ic)(t))),(0,D.F)((()=>(0,w.L)(t))),(0,D.F)((()=>(0,N.cd)(t))),(0,D.F)((()=>(0,R.Z)(t))),await Promise.all([(0,p.Q)(t),(0,p.Ac)(t).then((()=>{(0,D.F)((()=>(0,j.Z)(t)))}))])}(e),P(t,e))return;const{currentInstanceInfo:n}=t.get();if(!n)return;!function(t,e,n){const{accessToken:s}=t.get(),i=n.urls.streaming_api,o=t.getFirstTimelineItemId(e,"home"),a=t.getFirstTimelineItemId(e,"notifications");W=A(i,e,s,"home",o,a),!1}(t,e,n)}(t,e),(0,o.s)(`refreshInstanceDataAndStream-${e}`)}function P(t,e){return t.get().currentInstance!==e}function L(){let t;u.h.observe("currentTimeline",(async e=>{if(t&&(t.close(),t=null),!(n=e)||"local"!==n&&"federated"!==n&&"direct"!==n&&!n.startsWith("list/")&&!n.startsWith("tag/"))return;var n;const{currentInstance:s}=u.h.get(),{accessToken:i}=u.h.get();await(0,p.Q)(s);if(!(()=>{const{currentInstance:t,currentTimeline:n}=u.h.get();return t===s&&n===e})())return;const o=u.h.getFirstTimelineItemId(s,e),{currentInstanceInfo:a}=u.h.get(),r=a.urls.streaming_api;t=A(r,s,i,e,o)}))}var B=n(6714);let U=!1;function M(){u.h.observe("hasNotifications",(t=>{var e;e=()=>{U!==t&&(function(t){const e="theFavicon",n=document.getElementById(e);if(n.getAttribute("href")===t)return;const s=document.createElement("link");s.id=e,s.rel="shortcut icon",s.type="image/png",s.href=t,document.head.removeChild(n),document.head.appendChild(s)}(t?"/favicon-alert.png":"/favicon.png"),U=!U)},u.h.get().pageVisibilityHidden?e():(0,B.t)()?(0,D.F)(e):requestAnimationFrame(e)}))}var z=n(7980);var q=new Map;var G=function(){var t=null;try{t=document.createElement("canvas").getContext("2d")}catch(s){}if(!t)return function(){return!1};var e=20,n=Math.floor(12.5);return t.font=n+"px Arial, Sans-Serif",t.textBaseline="top",t.canvas.width=40,t.canvas.height=25,function(n){t.clearRect(0,0,40,25),t.fillStyle="#FF0000",t.fillText(n,0,22),t.fillStyle="#0000FF",t.fillText(n,e,22);for(var s=t.getImageData(0,0,e,25).data,i=s.length,o=0;o<i&&!s[o+3];o+=4);if(o>=i)return!1;var a=e+o/4%e,r=Math.floor(o/4/e),c=t.getImageData(a,r,1,1).data;return s[o]===c[0]&&s[o+2]===c[2]&&!(t.measureText(n).width>=e)}}();!function(t){q=t}(new(n(4986).c)({maxSize:500}));const H=function(t){if(q.has(t))return q.get(t);var e=G(t);return q.set(t,e),e};function Z(t){let e=!1;return(0,D.F)((async()=>{if(e)return;const n=await async function(t){let e=await z.jk(t);const n=[];if(t.startsWith(":")&&t.endsWith(":")){const n=t.substring(1,t.length-1).toLowerCase();e=e.filter((t=>t.shortcodes.includes(n)))}(0,o.B)("testEmojiSupported");for(const s of e){if(4===n.length)break;(s.url||H(s.unicode))&&n.push(s)}return(0,o.s)("testEmojiSupported"),n}(t);e||u.h.setForCurrentAutosuggest({autosuggestType:"emoji",autosuggestSelected:0,autosuggestSearchResults:n})})),{cancel:()=>{e=!0}}}var V=n(2909),Q=n(6172),K=n(3006),X=n(1632);const J=new class{constructor(t){this._timeout=t,this._promise=Promise.resolve()}next(){const t=this._promise;return this._promise=this._promise.then((()=>new Promise((t=>setTimeout(t,this._timeout))))),t}}(200);class Y{constructor(t){this._canceled=!1,this._controller="function"==typeof AbortController&&new AbortController,this._fetcher=t}async request(){if(this._canceled)throw new Error("canceled");if(await J.next(),this._canceled)throw new Error("canceled");const t=this._controller&&this._controller.signal;return this._fetcher(t)}cancel(){this._canceled=!0,this._controller&&(this._controller.abort(),this._controller=null)}}function tt(t,e){const n=t.acct.toLowerCase(),s=e.acct.toLowerCase();return n<s?-1:n===s?0:1}function et(t){return t.id}function nt(t){let e,n,s=!1;const{currentInstance:i,accessToken:o}=u.h.get(),a=new Y((async function(e){return(await(0,Q.y)(i,o,t,!1,4,!1,e)).accounts}));function r(){if(s)return;const t=function(){let t=(e||[]).slice().sort(tt).slice(0,4);if(t.length<4){const e=(n||[]).sort(tt).slice(0,4-t.length);t=(0,K.z)(t,e),t=(0,X.Z)(t,et)}return t}();u.h.setForCurrentAutosuggest({autosuggestType:"account",autosuggestSelected:0,autosuggestSearchResults:t})}function c(t){console.warn("ignored autosuggest error",t)}return(0,D.F)((()=>{s||(async function(){e=await V.F.searchAccountsByUsername(i,t.substring(1),30)}().then(r).catch(c),async function(){n=await a.request()}().then(r).catch(c))})),{cancel:()=>{s=!0,a.cancel()}}}function st(t){return t.uses}function it(t,e){if(t.history&&e.history&&t.history.length&&e.history.length){const n=(0,s.Sm)(t.history.map(st)),i=(0,s.Sm)(e.history.map(st));return n>i?-1:n<i?1:0}return t.name<e.name?-1:t.name>e.name?1:0}function ot(){let t;u.h.observe("autosuggestSearchText",(async e=>{t&&(t.cancel(),t=null);const{composeFocused:n}=u.h.get(),s=u.h.getForCurrentAutosuggest("autosuggestSelecting");n&&e&&!s?t=e.startsWith(":")?Z(e):e.startsWith("#")?function(t){const{currentInstance:e,accessToken:n}=u.h.get(),s=new Y((async function(s){return(await(0,Q.y)(e,n,t,!1,10,!0,s)).hashtags.sort(it).slice(0,4)}));return(0,D.F)((async()=>{try{const t=await s.request();u.h.setForCurrentAutosuggest({autosuggestType:"hashtag",autosuggestSelected:0,autosuggestSearchResults:t})}catch(t){console.warn("ignored autosuggest error",t)}})),{cancel:()=>{s.cancel()}}}(e):nt(e):u.h.setForCurrentAutosuggest({autosuggestSelected:0,autosuggestSearchResults:[]})}))}const at=document.getElementById("theScrollbarStyle");var rt=n(2138);var ct=n(8513),ut=n(9898);function lt(){const t=Date.now();let e=0;const{composeData:n}=u.h.get();for(const s of Object.values(n))for(const[n,i]of Object.entries(s)){if("home"===n||"dialog"===n)continue;t-(i.ts||0)>ct.f&&(delete s[n],e++)}e&&u.h.set({composeData:n})}function ht(){(0,D.F)(lt)}var mt=n(9921),ft=n(5918);var gt=n(6077),dt=n(6877);function pt(){let t=!1;u.h.observe("currentVerifyCredentials",(async e=>{if(e&&!t){t=!0;const{currentPage:e}=u.h.get();"home"===e&&"true"===new URLSearchParams(location.search).get("compose")&&await async function(){const{isUserLoggedIn:t}=u.h.get();if(!t)return;const e=(0,gt.B)(),n=await V.F.getWebShareData();n&&await V.F.deleteWebShareData();const{title:s,text:i,url:o,file:a}=n||{},r=[s,i,o].filter(Boolean).join("\n\n");u.h.clearComposeData("dialog"),u.h.setComposeData("dialog",{text:r}),u.h.save(),(await e)(),a&&(0,dt.m)("dialog",a)}()}}))}var wt=n(3915);const yt=(0,n(6918).I)((()=>(0,wt.i)()&&"undefined"==typeof cookieStore));function St(t,e,n,s,i){const o=function(t,e){const{statusModifications:n}=t.get();return n[e]=n[e]||{favorites:{},reblogs:{},pins:{},bookmarks:{}},n}(t,e);o[e][s][n]=i,t.set({statusModifications:o})}var vt;(vt=u.A).prototype.setComposeData=function(t,e){const{composeData:n,currentInstance:s}=this.get(),i=n[s]=n[s]||{};i[t]=Object.assign(i[t]||{},{ts:Date.now()},e),this.set({composeData:n})},vt.prototype.getComposeData=function(t,e){const{composeData:n,currentInstance:i}=this.get();return(0,s.U2)(n,[i,t,e])},vt.prototype.clearComposeData=function(t){const{composeData:e,currentInstance:n}=this.get();e&&e[n]&&delete e[n][t],this.set({composeData:e})},function(t){t.prototype.setForTimeline=function(t,e,n){const s={};for(const i of Object.keys(n)){const o=`timelineData_${i}`,a=this.get()[o]||{};(a[t]=a[t]||{})[e]=n[i],s[o]=a}this.set(s)},t.prototype.getForTimeline=function(t,e,n){const i=`timelineData_${n}`,o=this.get()[i];return(0,s.U2)(o,[t,e])},t.prototype.getAllTimelineData=function(t,e){return(this.get()[`timelineData_${e}`]||{})[t]||{}},t.prototype.getFirstTimelineItemId=function(t,e){return i(this.getForTimeline(t,e,"timelineItemSummaries"))},t.prototype.setForCurrentTimeline=function(t){const{currentInstance:e,currentTimeline:n}=this.get();this.setForTimeline(e,n,t)},t.prototype.getThreads=function(t){const e=this.getAllTimelineData(t,"timelineItemSummaries");return(0,s.D9)(e,((t,e)=>e.startsWith("status/")))},t.prototype.clearTimelineDataForInstance=function(t){const e={};Object.entries(this.get()).forEach((([n,s])=>{n.startsWith("timelineData_")&&s&&(delete s[t],e[n]=s)})),this.set(e)}}(u.A),function(t){t.prototype.setStatusFavorited=function(t,e,n){St(this,t,e,"favorites",n)},t.prototype.setStatusReblogged=function(t,e,n){St(this,t,e,"reblogs",n)},t.prototype.setStatusPinned=function(t,e,n){St(this,t,e,"pins",n)},t.prototype.setStatusBookmarked=function(t,e,n){St(this,t,e,"bookmarks",n)}}(u.A),function(t){t.prototype.setForAutosuggest=function(t,e,n){const s={};for(const i of Object.keys(n)){const o=`autosuggestData_${i}`,a=this.get()[o]||{};(a[t]=a[t]||{})[e]=n[i],s[o]=a}this.set(s)},t.prototype.setForCurrentAutosuggest=function(t){const{currentInstance:e,currentComposeRealm:n}=this.get();this.setForAutosuggest(e,n,t)},t.prototype.getForCurrentAutosuggest=function(t){const{currentInstance:e,currentComposeRealm:n}=this.get();return(0,s.U2)(this.get()[`autosuggestData_${t}`],[e,n])},t.prototype.clearAutosuggestDataForInstance=function(t){const e={};Object.entries(this.get()).forEach((([n,s])=>{n.startsWith("autosuggestData_")&&s&&(delete s[t],e[n]=s)})),this.set(e)}}(u.A),(0,o.B)("loggedInComputations"),h(u.h),function(t){(0,o.B)("timelineComputations"),a(t,"timelineItemSummaries",null),a(t,"timelineItemSummariesToAdd",null),a(t,"runningUpdate",!1),a(t,"lastFocusedElementId",null),a(t,"ignoreBlurEvents",!1),a(t,"showHeader",!1),a(t,"shouldShowHeader",!1),a(t,"timelineItemSummariesAreStale",!1),a(t,"timelineNextPageId",null),t.compute("currentTimelineType",["currentTimeline"],(t=>t&&t.split("/")[0])),t.compute("currentTimelineValue",["currentTimeline"],(t=>{if(!t)return;const e=t.split("/"),n=e.length;return"with_replies"===e[n-1]||"media"===e[n-1]?e[n-2]:e[n-1]})),t.compute("firstTimelineItemId",["timelineItemSummaries"],(t=>i(t))),t.compute("lastTimelineItemId",["timelineItemSummaries"],(t=>{return(e=t)&&e[e.length-1]&&e[e.length-1].id;var e})),(0,o.s)("timelineComputations")}(u.h),function(t){g(t,"timelineShowReblogs",{home:m.Z3,notifications:m.cT}),g(t,"timelineShowReplies",{home:m.B$}),g(t,"timelineShowFollows",{notifications:m.dS}),g(t,"timelineShowFavs",{notifications:m.AL}),g(t,"timelineShowMentions",{notifications:m.M9}),g(t,"timelineShowPolls",{notifications:m.rs}),d(t,"timelineNotificationShowReblogs",m.cT),d(t,"timelineNotificationShowFollows",m.dS),d(t,"timelineNotificationShowFavs",m.AL),d(t,"timelineNotificationShowMentions",m.M9),d(t,"timelineNotificationShowPolls",m.rs),t.compute("timelineWordFilterContext",["currentTimeline"],(t=>{if(t)return"home"===t||t.startsWith("list/")?l.Ny:"notifications"===t||t.startsWith("notifications/")?l.zW:"federated"===t||"local"===t||t.startsWith("tag/")?l.wM:t.startsWith("account/")?l.aO:t.startsWith("status/")?l.IO:void 0})),t.compute("timelineFilterFunction",["timelineShowReblogs","timelineShowReplies","timelineShowFollows","timelineShowFavs","timelineShowMentions","timelineShowPolls","timelineWordFilterContext"],((t,e,n,s,i,o,a)=>f(t,e,n,s,i,o,a))),t.compute("timelineNotificationFilterFunction",["timelineNotificationShowReblogs","timelineNotificationShowFollows","timelineNotificationShowFavs","timelineNotificationShowMentions","timelineNotificationShowPolls"],((t,e,n,s,i)=>f(t,!0,e,n,s,i,l.zW))),t.compute("filteredTimelineItemSummaries",["timelineItemSummaries","timelineFilterFunction"],((t,e)=>t&&t.filter(e))),t.compute("filteredTimelineItemSummariesToAdd",["timelineItemSummariesToAdd","timelineFilterFunction"],((t,e)=>t&&t.filter(e))),t.compute("timelineNotificationItemSummaries",["timelineData_timelineItemSummariesToAdd","timelineFilterFunction","currentInstance"],((t,e,n)=>(0,s.U2)(t,[n,"notifications"]))),t.compute("filteredTimelineNotificationItemSummaries",["timelineNotificationItemSummaries","timelineNotificationFilterFunction"],((t,e)=>t&&t.filter(e)))}(u.h),function(t){t.compute("numberOfNotifications",["filteredTimelineNotificationItemSummaries","disableNotificationBadge"],((t,e)=>!e&&t?t.length:0)),t.compute("hasNotifications",["numberOfNotifications","currentPage"],((t,e)=>"notifications"!==e&&!!t)),t.compute("numberOfFollowRequests",["followRequestCounts","currentInstance"],((t,e)=>(0,s.U2)(t,[e],0))),t.compute("hasFollowRequests",["numberOfFollowRequests"],(t=>!!t)),t.compute("badgeNumber",["numberOfFollowRequests","numberOfNotifications"],((t,e)=>t+e))}(u.h),function(t){(0,o.B)("autosuggestComputations"),c(t,"composeFocused",!1),c(t,"composeSelectionStart",0),c(t,"autosuggestSelected",0),c(t,"autosuggestSearchResults",[]),c(t,"autosuggestType",null),t.compute("currentComposeText",["currentComposeData","currentComposeRealm"],((t,e)=>(0,s.U2)(t,[e,"text"],""))),t.compute("autosuggestSearchText",["currentComposeText","composeSelectionStart"],((t,e)=>{const n=e;if(!t||n<2)return"";const s=t.substring(0,n).match(r);return s&&s[1]||""})),t.compute("autosuggestNumSearchResults",["autosuggestSearchResults"],(t=>t.length)),t.compute("autosuggestShown",["composeFocused","autosuggestSearchText","autosuggestNumSearchResults"],((t,e,n)=>!!(t&&e&&n))),(0,o.s)("autosuggestComputations")}(u.h),(0,o.s)("loggedInComputations"),u.h.observe("currentInstance",(async t=>{W&&(W.close(),W=null),t&&(0,D.F)((()=>$(u.h,t)))})),L(),function(){function t(t,e){const n=Object.fromEntries(Object.entries(e).map((([e,n])=>[e,n.filter((e=>!e.expires_at||new Date(e.expires_at).getTime()>=t))])));(0,mt.Z)(u.h.get().unexpiredInstanceFilters,n)||u.h.set({unexpiredInstanceFilters:n})}(0,_.on)("wordFiltersChanged",(t=>{(0,N.A_)(t)})),u.h.observe("now",(e=>{const{instanceFilters:n}=u.h.get();t(e,n)})),u.h.observe("instanceFilters",(e=>{const{now:n}=u.h.get();t(n,e)})),u.h.observe("unexpiredInstanceFilterRegexes",(async t=>{(0,o.B)("update timeline item summary filter contexts");let{timelineData_timelineItemSummaries:e,timelineData_timelineItemSummariesToAdd:n}=u.h.get();e=e||{},n=n||{};let s=!1;if(await Promise.all(Object.entries(t).map((async([t,i])=>{const o=e[t]||{},a=n[t]||{},r=[...Object.values(o).flat(),...Object.values(a).flat()];r.length,await Promise.all(r.map((async e=>{try{const n=e.type,o=await(n?V.F.getNotification(t,e.id):V.F.getStatus(t,e.id)),a=(0,ft.b)(o,i);(0,mt.Z)(e.filterContexts,a)||(s=!0,e.filterContexts=a)}catch(n){console.error(n)}})))}))),s){const{timelineData_timelineItemSummaries:t,timelineData_timelineItemSummariesToAdd:e}=u.h.get();u.h.set({timelineData_timelineItemSummaries:t,timelineData_timelineItemSummariesToAdd:e})}(0,o.s)("update timeline item summary filter contexts")}),{init:!1})}(),M(),ot(),navigator.permissions&&navigator.permissions.query&&navigator.permissions.query({name:"notifications"}).then((t=>{u.h.set({notificationPermission:t.state}),t.onchange=t=>{u.h.set({notificationPermission:t.target.state})}})),u.h.observe("disableCustomScrollbars",(t=>{at.setAttribute("media",t?"only x":"all")}),{init:!1}),function(){function t(t,e){const n=(0,rt.x)(t,e);z.fK(n)}u.h.observe("currentCustomEmoji",(e=>{t(e,u.h.get().autoplayGifs)}),{init:!1}),u.h.observe("autoplayGifs",(e=>{t(u.h.get().currentCustomEmoji,e)}),{init:!1})}(),pt(),!yt()&&"setAppBadge"in navigator&&u.h.observe("badgeNumber",(t=>{t?navigator.setAppBadge(t):navigator.clearAppBadge()})),(0,ut._)(ht,ct.P,!1)},4986:(t,e,n)=>{"use strict";n.d(e,{c:()=>i});var s=n(9749);class i extends s.EventEmitter{constructor(t={}){if(super(),!(t.maxSize&&t.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");this.maxSize=t.maxSize,this.cache=new Map,this.oldCache=new Map,this._size=0}_set(t,e){if(this.cache.set(t,e),this._size++,this._size>=this.maxSize){if(this._size=0,this.listenerCount("evict"))for(const t of this.oldCache.keys())this.cache.has(t)||this.emit("evict",this.oldCache.get(t),t);this.oldCache=this.cache,this.cache=new Map}}get(t){if(this.cache.has(t))return this.cache.get(t);if(this.oldCache.has(t)){const e=this.oldCache.get(t);return this.oldCache.delete(t),this._set(t,e),e}}set(t,e){return this.cache.has(t)?this.cache.set(t,e):this._set(t,e),this}has(t){return this.cache.has(t)||this.oldCache.has(t)}delete(t){const e=this.cache.delete(t);return e&&this._size--,this.oldCache.delete(t)||e}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}getAllKeys(){const t=new Set;for(const e of this.cache.keys())t.add(e);for(const e of this.oldCache.keys())t.add(e);return t}}},8273:(t,e,n)=>{"use strict";n.d(e,{EH:()=>s,HZ:()=>i,$Q:()=>o,gz:()=>u,v_:()=>l,U2:()=>h,SM:()=>m,IV:()=>f,pe:()=>g});const s=2e4,i=9e4,o=45e3;function a(t,e,n){const s={method:t,headers:Object.assign(e||{},{Accept:"application/json"})};return n&&n.signal&&(s.signal=n.signal),s}async function r(t,e,n){let s;return s=n&&n.timeout?await function(t,e,n){return new Promise(((s,i)=>{fetch(t,e).then(s,i),setTimeout((()=>i(new Error(`Timed out after ${n/1e3} seconds`))),n)}))}(t,e,n.timeout):await fetch(t,e),async function(t){if(t.status>=300){const e=new Error("Request failed: "+t.status);throw e.status=t.status,e}const e=await t.json();if(t.status>=200&&t.status<300)return{json:e,headers:t.headers};if(e&&e.error)throw new Error(t.status+": "+e.error);throw new Error("Request failed: "+t.status)}(s)}async function c(t,e,n,s,i){const o=a(t,s,i);return n&&(n instanceof FormData?o.body=n:(o.body=JSON.stringify(n),o.headers["Content-Type"]="application/json")),r(e,o,i)}async function u(t,e,n,s){return(await c("PUT",t,e,n,s)).json}async function l(t,e,n,s){return(await c("POST",t,e,n,s)).json}async function h(t,e,n){return(await r(t,a("GET",e,n),n)).json}async function m(t,e,n){return r(t,a("GET",e,n),n)}async function f(t,e,n){return(await r(t,a("DELETE",e,n),n)).json}function g(t){let e="",n=-1;return Object.keys(t).forEach((s=>{const i=t[s];if(Array.isArray(i))for(const t of i)e+=(++n>0?"&":"")+encodeURIComponent(s)+"[]="+encodeURIComponent(t);else e+=(++n>0?"&":"")+encodeURIComponent(s)+"="+encodeURIComponent(i)})),e}},2138:(t,e,n)=>{"use strict";function s(t,e){return t?t.filter((t=>t.visible_in_picker)).map((t=>({name:t.shortcode,shortcodes:[t.shortcode],url:e?t.url:t.static_url,category:t.category}))):[]}n.d(e,{x:()=>s})},7980:(t,e,n)=>{"use strict";n.d(e,{fK:()=>u,XB:()=>l,jk:()=>h});var s=n(398),i=n(673),o=n(4963);let a;function r(t,e){if(!t||t.url)return t;const n={unicode:t.unicode,shortcodes:t.shortcodes};if(e>0&&t.skins){const s=t.skins.find((t=>t.tone===e));s&&(n.unicode=s.unicode)}return n}function c(){a||(a=new s.Z({locale:o.FO,dataSource:o.jN}))}function u(t){c(),a.customEmoji=t}async function l(t){c();const[e,n]=await Promise.all([a.getEmojiByUnicodeOrName(t),a.getPreferredSkinTone()]);return r(e,n)}async function h(t){c();const[e,n]=await Promise.all([a.getEmojiBySearchQuery(t),a.getPreferredSkinTone()]);return e.map((t=>r(t,n)))}i.S.addEventListener("statechange",(t=>{"frozen"===t.newState&&a&&a.close()}))},6714:(t,e,n)=>{"use strict";n.d(e,{t:()=>s});const s=(0,n(6918).I)((()=>navigator.userAgent.match(/(?:iPhone|iPod|iPad|Android|KAIOS)/)))}}]);
//# sourceMappingURL=4137.83ba56a14a3651074311.4137.js.map