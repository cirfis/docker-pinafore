{"version":3,"sources":["webpack://pinafore/./src/routes/_components/dialog/components/ModalDialog.html","webpack://pinafore/./src/routes/_components/dialog/helpers/createDialogElement.js","webpack://pinafore/./src/routes/_components/dialog/helpers/createDialogId.js","webpack://pinafore/./src/routes/_components/dialog/creators/showDialog.js","webpack://pinafore/./src/routes/_components/dialog/helpers/closeDialog.js","webpack://pinafore/./src/routes/_components/dialog/helpers/onCreateDialog.js","webpack://pinafore/./src/routes/_components/dialog/helpers/showDialog.js","webpack://pinafore/./src/routes/_thirdparty/a11y-dialog/a11y-dialog.js"],"names":["otherId","id","this","get","setTimeout","requestAnimationFrame","window","addEventListener","onPopState","set","statePushed","history","pushState","modal","location","href","document","body","classList","toggle","_a11yDialog","show","fadedIn","fire","event","state","statePopped","closeDialog","hide","e","clickHeaderToClose","preventDefault","stopPropagation","bind","dialogElement","refs","node","parentElement","on","destroy","removeChild","showDialog","removeEventListener","back","title","shouldAnimate","getElementsByClassName","length","muted","className","undefined","shrinkWidthToFit","onClickHeader","backdropClass","background","contentsClass","label","createDialogElement","div","createElement","setAttribute","appendChild","count","Dialog","data","dialog","target","Object","assign","close","onDestroy","thisId","oncreate","FOCUSABLE_ELEMENTS_QUERY","shadowRoots","focusedBeforeDialog","A11yDialog","targets","_show","_hide","_maintainFocus","_bindKeypress","_listeners","create","toArray","collection","Array","prototype","slice","call","$$","selector","context","querySelectorAll","setFocusToFirstItem","focusableChildren","getFocusableChildren","focus","isAncestor","ancestor","parent","candidateFocusableChildren","shadowRoot","getRootNode","host","push","filter","child","disabled","test","getAttribute","hasAttribute","offsetWidth","offsetHeight","getClientRects","registerShadowRoot","includes","unregisterShadowRoot","index","indexOf","splice","_targets","NodeList","isPrototypeOf","Element","collect","siblings","parentNode","childNodes","nodeType","getSiblings","shown","_openers","forEach","opener","_closers","concat","closer","_fire","removeAttribute","original","activeElement","type","handler","off","listener","which","focusedItemIndex","shiftKey","trapTabKey","contains"],"mappings":"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","file":"7608.a430a14703e20b958612.7608.js","sourcesContent":["<div class={backdropClass}\n     tabindex=\"-1\"\n     data-a11y-dialog-hide\n></div>\n<div class={contentsClass}\n     role=\"dialog\"\n     aria-label={label || ''}\n     ref:node\n>\n  <div class=\"modal-dialog-document\" role=\"document\" style=\"background: {background || '#000'};\">\n    <div class=\"modal-dialog-header\" on:click=\"onClickHeader(event)\">\n      {#if title}\n        <h1 class=\"modal-dialog-title\">{title}</h1>\n      {/if}\n      <div class=\"close-dialog-button-wrapper\">\n        <button class=\"close-dialog-button focus-fix\"\n                data-a11y-dialog-hide aria-label=\"Close dialog\">\n          <SvgIcon className=\"close-dialog-button-svg\" href=\"#fa-times\" />\n        </button>\n      </div>\n    </div>\n    <slot></slot>\n  </div>\n</div>\n<Shortcut scope=\"modal-{id}\" key=\"Backspace\" on:pressed=\"closeDialog(id)\"/>\n<style>\n  :global(.modal-dialog[aria-hidden='true']) {\n    display: none;\n  }\n  :global(.modal-dialog) {\n    position: fixed;\n    z-index: 10000;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    left: 0;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n  }\n\n  .modal-dialog-backdrop {\n    position: fixed;\n    z-index: 10010;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    top: 0;\n    background: rgba(51, 51, 51, 0.9);\n  }\n  .modal-dialog-backdrop.should-animate {\n    transition: opacity 0.2s linear;\n  }\n  .modal-dialog-contents {\n    z-index: 10020;\n    padding: 0;\n    border: 1px solid var(--main-border);\n    border-radius: 2px;\n    display: flex;\n    flex-direction: row;\n    max-height: calc(100% - 20px);\n    max-width: calc(100% - 20px);\n    flex: 0 1 580px;\n  }\n  .modal-dialog-contents.should-animate {\n    transition: opacity 0.2s linear;\n  }\n\n  .modal-dialog-document {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    width: 100%;\n    max-width: 100%;\n    flex: 1;\n  }\n  .modal-dialog-header {\n    width: 100%;\n    background: var(--nav-bg);\n    display: flex;\n    align-items: center;\n  }\n  .modal-dialog-title {\n    color: var(--nav-text-color);\n    padding: 2px 0 2px 10px;\n    margin: 0;\n    font-size: 1.5em;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n  }\n  .close-dialog-button-wrapper {\n    flex: 1;\n    display: flex;\n    justify-content: flex-end;\n  }\n  .close-dialog-button {\n    padding: 0;\n    background: none;\n    border: none;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n  }\n  :global(.close-dialog-button-svg) {\n    padding: 10px;\n    fill: var(--button-primary-text);\n    width: 24px;\n    height: 24px;\n    flex: 1;\n  }\n  .muted-style .modal-dialog-header {\n    background: var(--muted-modal-bg);\n  }\n  .muted-style .close-dialog-button:focus {\n    outline: 2px solid var(--muted-modal-focus);\n  }\n  .muted-style .close-dialog-button:hover {\n    background: var(--muted-modal-hover);\n  }\n  .muted-style.modal-dialog-contents {\n    border: none;\n  }\n  :global(body.modal-open) {\n    overflow-y: hidden;\n  }\n\n  @media(min-width: 480px) {\n    /* On desktop, some dialogs look bad if they expand to fit all the way. So we shrink\n       them to fit if shrinkWidthToFit is true.*/\n    .modal-dialog-contents.shrink-width-to-fit {\n      flex: none;\n    }\n  }\n\n  @media (max-width: 320px) {\n    .modal-dialog-title {\n      font-size: 1.3em;\n    }\n    :global(.close-dialog-button-svg) {\n      padding: 7px;\n      width: 18px;\n      height: 18px;\n    }\n  }\n\n  @media (max-width: 240px) {\n    .modal-dialog-contents {\n      min-width: calc(100% - 20px);\n    }\n  }\n</style>\n<script>\n  import Shortcut from '../../shortcut/Shortcut.html'\n  import SvgIcon from '../../SvgIcon.html'\n  import { A11yDialog } from '../../../_thirdparty/a11y-dialog/a11y-dialog'\n  import { classname } from '../../../_utils/classname'\n  import { on, emit } from '../../../_utils/eventBus'\n  import {\n    pushShortcutScope,\n    popShortcutScope\n  } from '../../../_utils/shortcuts'\n\n  export default {\n    oncreate () {\n      const { id } = this.get()\n      this.onPopState = this.onPopState.bind(this)\n      const dialogElement = this.refs.node.parentElement\n      this._a11yDialog = new A11yDialog(dialogElement)\n      this._a11yDialog.on('hide', () => {\n        document.body.classList.toggle('modal-open', false)\n        this.fire('close')\n        this._a11yDialog.destroy()\n        emit('destroyDialog', id)\n        requestAnimationFrame(() => document.body.removeChild(dialogElement))\n      })\n      on('showDialog', this, this.showDialog)\n      on('closeDialog', this, this.closeDialog)\n      pushShortcutScope(`modal-${id}`)\n    },\n    ondestroy () {\n      window.removeEventListener('popstate', this.onPopState)\n      const { statePopped, statePushed, id } = this.get()\n      if (statePushed && !statePopped) {\n        // If we weren't closed due to popstate, then pop state to ensure the correct history.\n        window.history.back()\n      }\n      popShortcutScope(`modal-${id}`)\n    },\n    components: { Shortcut, SvgIcon },\n    data: () => ({\n      // don't animate if we're showing a modal dialog on top of another modal dialog. it looks ugly\n      shouldAnimate: !process.browser || document.getElementsByClassName('modal-dialog').length < 2,\n      fadedIn: false,\n      muted: false,\n      className: undefined,\n      title: undefined,\n      shrinkWidthToFit: false,\n      clickHeaderToClose: false\n    }),\n    computed: {\n      backdropClass: ({ fadedIn, shouldAnimate }) => {\n        return classname(\n          'modal-dialog-backdrop',\n          !fadedIn && 'hidden',\n          shouldAnimate && 'should-animate'\n        )\n      },\n      contentsClass: ({ fadedIn, muted, shouldAnimate, shrinkWidthToFit, className }) => {\n        return classname(\n          'modal-dialog-contents',\n          !fadedIn && 'hidden',\n          muted && 'muted-style',\n          shouldAnimate && 'should-animate',\n          shrinkWidthToFit && 'shrink-width-to-fit',\n          className\n        )\n      }\n    },\n    methods: {\n      showDialog (otherId) {\n        const { id } = this.get()\n        if (otherId !== id) {\n          return\n        }\n        // This setTimeout is dumb, but it fixes issues with modals opening other modals\n        // due to the popstate/pushstate dance.\n        setTimeout(() => {\n          requestAnimationFrame(() => {\n            window.addEventListener('popstate', this.onPopState)\n            this.set({ statePushed: true })\n            window.history.pushState({ modal: id }, null, location.href)\n            document.body.classList.toggle('modal-open', true)\n            this._a11yDialog.show()\n            this.set({ fadedIn: true })\n            this.fire('show')\n            emit('dialogDidRender', id)\n          })\n        })\n      },\n      onPopState (event) {\n        const { id } = this.get()\n        if (!(event.state && event.state.modal === id)) {\n          // If the new state is not us, just assume that we need to be closed.\n          // This will only fail if modals are ever nested more than 2 levels deep.\n          this.set({ statePopped: true })\n          this.closeDialog(id)\n        }\n      },\n      closeDialog (otherId) {\n        const { id } = this.get()\n        if (id !== otherId) {\n          return\n        }\n        this._a11yDialog.hide()\n      },\n      onClickHeader (e) {\n        if (this.get().clickHeaderToClose) {\n          e.preventDefault()\n          e.stopPropagation()\n          this._a11yDialog.hide()\n        }\n      }\n    }\n  }\n</script>\n","export function createDialogElement () {\n  const div = document.createElement('div')\n  div.setAttribute('class', 'modal-dialog')\n  div.setAttribute('aria-hidden', 'true')\n  document.body.appendChild(div)\n  return div\n}\n","let count = -1\n\nexport function createDialogId () {\n  return ++count\n}\n","import { createDialogElement } from '../helpers/createDialogElement'\nimport { createDialogId } from '../helpers/createDialogId'\n\nexport function showDialog (Dialog, data) {\n  const dialog = new Dialog({\n    target: createDialogElement(),\n    data: Object.assign({\n      id: createDialogId()\n    }, data)\n  })\n  dialog.show()\n  return dialog\n}\n","import { emit } from '../../../_utils/eventBus'\n\nexport function close () {\n  const { id } = this.get()\n  emit('closeDialog', id)\n}\n","import { on } from '../../../_utils/eventBus'\n\nfunction onDestroy (thisId) {\n  const { id } = this.get()\n  if (id !== thisId) {\n    return\n  }\n  this.destroy()\n}\n\nexport function oncreate () {\n  on('destroyDialog', this, onDestroy)\n}\n","import { emit } from '../../../_utils/eventBus'\n\nexport function show () {\n  const { id } = this.get()\n  emit('showDialog', id)\n}\n","// Forked from a11y-dialog 4.0.1, adding a small change to element.focus() to work\n// around a Chrome bug with sticky positioning (https://github.com/nolanlawson/pinafore/issues/671)\n// Now it also works around shadow DOM and video/audio with controls.\n// (video/audio with controls is not 100% fixable because we can't focus the elements inside, but\n// you can at least tab to the video/audio and use other controls, like space bar and left/right)\n// Original: https://unpkg.com/a11y-dialog@4.0.1/a11y-dialog.js\n\nexport const FOCUSABLE_ELEMENTS_QUERY = 'a[href], area[href], input, select, textarea, ' +\n  'button, iframe, object, embed, [contenteditable], [tabindex], ' +\n  'video[controls], audio[controls], summary'\nconst TAB_KEY = 9\nconst ESCAPE_KEY = 27\nconst shadowRoots = []\nlet focusedBeforeDialog\n\n/**\n   * Define the constructor to instantiate a dialog\n   *\n   * @constructor\n   * @param {Element} node\n   * @param {(NodeList | Element | string)} targets\n   */\nfunction A11yDialog (node, targets) {\n  // Prebind the functions that will be bound in addEventListener and\n  // removeEventListener to avoid losing references\n  this._show = this.show.bind(this)\n  this._hide = this.hide.bind(this)\n  this._maintainFocus = this._maintainFocus.bind(this)\n  this._bindKeypress = this._bindKeypress.bind(this)\n\n  // Keep a reference of the node on the instance\n  this.node = node\n\n  // Keep an object of listener types mapped to callback functions\n  this._listeners = {}\n\n  // Initialise everything needed for the dialog to work properly\n  this.create(targets)\n}\n\n/**\n   * Set up everything necessary for the dialog to be functioning\n   *\n   * @param {(NodeList | Element | string)} targets\n   * @return {this}\n   */\nA11yDialog.prototype.create = function (targets) {\n  // Keep a collection of nodes to disable/enable when toggling the dialog\n  this._targets = this._targets || collect(targets) || getSiblings(this.node)\n\n  // Make sure the dialog element is disabled on load, and that the `shown`\n  // property is synced with its value\n  this.node.setAttribute('aria-hidden', true)\n  this.shown = false\n\n  // Keep a collection of dialog openers, each of which will be bound a click\n  // event listener to open the dialog\n  this._openers = $$('[data-a11y-dialog-show=\"' + this.node.id + '\"]')\n  this._openers.forEach(function (opener) {\n    opener.addEventListener('click', this._show)\n  }.bind(this))\n\n  // Keep a collection of dialog closers, each of which will be bound a click\n  // event listener to close the dialog\n  this._closers = $$('[data-a11y-dialog-hide]', this.node)\n    .concat($$('[data-a11y-dialog-hide=\"' + this.node.id + '\"]'))\n  this._closers.forEach(function (closer) {\n    closer.addEventListener('click', this._hide)\n  }.bind(this))\n\n  // Execute all callbacks registered for the `create` event\n  this._fire('create')\n\n  return this\n}\n\n/**\n   * Show the dialog element, disable all the targets (siblings), trap the\n   * current focus within it, listen for some specific key presses and fire all\n   * registered callbacks for `show` event\n   *\n   * @param {Event} event\n   * @return {this}\n   */\nA11yDialog.prototype.show = function (event) {\n  // If the dialog is already open, abort\n  if (this.shown) {\n    return this\n  }\n\n  this.shown = true\n  this.node.removeAttribute('aria-hidden')\n\n  // Iterate over the targets to disable them by setting their `aria-hidden`\n  // attribute to `true`; in case they already have this attribute, keep a\n  // reference of their original value to be able to restore it later\n  this._targets.forEach(function (target) {\n    const original = target.getAttribute('aria-hidden')\n\n    if (original) {\n      target.setAttribute('data-a11y-dialog-original', original)\n    }\n\n    target.setAttribute('aria-hidden', 'true')\n  })\n\n  // Keep a reference to the currently focused element to be able to restore\n  // it later, then set the focus to the first focusable child of the dialog\n  // element\n  focusedBeforeDialog = document.activeElement\n  setFocusToFirstItem(this.node)\n\n  // Bind a focus event listener to the body element to make sure the focus\n  // stays trapped inside the dialog while open, and start listening for some\n  // specific key presses (TAB and ESC)\n  document.body.addEventListener('focus', this._maintainFocus, true)\n  document.addEventListener('keydown', this._bindKeypress)\n\n  // Execute all callbacks registered for the `show` event\n  this._fire('show', event)\n\n  return this\n}\n\n/**\n   * Hide the dialog element, enable all the targets (siblings), restore the\n   * focus to the previously active element, stop listening for some specific\n   * key presses and fire all registered callbacks for `hide` event\n   *\n   * @param {Event} event\n   * @return {this}\n   */\nA11yDialog.prototype.hide = function (event) {\n  // If the dialog is already closed, abort\n  if (!this.shown) {\n    return this\n  }\n\n  this.shown = false\n  this.node.setAttribute('aria-hidden', 'true')\n\n  // Iterate over the targets to enable them by remove their `aria-hidden`\n  // attribute or resetting them to their initial value\n  this._targets.forEach(function (target) {\n    const original = target.getAttribute('data-a11y-dialog-original')\n\n    if (original) {\n      target.setAttribute('aria-hidden', original)\n      target.removeAttribute('data-a11y-dialog-original')\n    } else {\n      target.removeAttribute('aria-hidden')\n    }\n  })\n\n  // If their was a focused element before the dialog was opened, restore the\n  // focus back to it\n  if (focusedBeforeDialog) {\n    // This double rAF is to work around a bug in Chrome when focusing sticky-positioned\n    // elements. See https://github.com/nolanlawson/pinafore/issues/671\n    requestAnimationFrame(() => requestAnimationFrame(() => focusedBeforeDialog.focus()))\n  }\n\n  // Remove the focus event listener to the body element and stop listening\n  // for specific key presses\n  document.body.removeEventListener('focus', this._maintainFocus, true)\n  document.removeEventListener('keydown', this._bindKeypress)\n\n  // Execute all callbacks registered for the `hide` event\n  this._fire('hide', event)\n\n  return this\n}\n\n/**\n   * Destroy the current instance (after making sure the dialog has been hidden)\n   * and remove all associated listeners from dialog openers and closers\n   *\n   * @return {this}\n   */\nA11yDialog.prototype.destroy = function () {\n  // Hide the dialog to avoid destroying an open instance\n  this.hide()\n\n  // Remove the click event listener from all dialog openers\n  this._openers.forEach(function (opener) {\n    opener.removeEventListener('click', this._show)\n  }.bind(this))\n\n  // Remove the click event listener from all dialog closers\n  this._closers.forEach(function (closer) {\n    closer.removeEventListener('click', this._hide)\n  }.bind(this))\n\n  // Execute all callbacks registered for the `destroy` event\n  this._fire('destroy')\n\n  // Keep an object of listener types mapped to callback functions\n  this._listeners = {}\n\n  return this\n}\n\n/**\n   * Register a new callback for the given event type\n   *\n   * @param {string} type\n   * @param {Function} handler\n   */\nA11yDialog.prototype.on = function (type, handler) {\n  if (typeof this._listeners[type] === 'undefined') {\n    this._listeners[type] = []\n  }\n\n  this._listeners[type].push(handler)\n\n  return this\n}\n\n/**\n   * Unregister an existing callback for the given event type\n   *\n   * @param {string} type\n   * @param {Function} handler\n   */\nA11yDialog.prototype.off = function (type, handler) {\n  const index = this._listeners[type].indexOf(handler)\n\n  if (index > -1) {\n    this._listeners[type].splice(index, 1)\n  }\n\n  return this\n}\n\n/**\n   * Iterate over all registered handlers for given type and call them all with\n   * the dialog element as first argument, event as second argument (if any).\n   *\n   * @access private\n   * @param {string} type\n   * @param {Event} event\n   */\nA11yDialog.prototype._fire = function (type, event) {\n  const listeners = this._listeners[type] || []\n\n  listeners.forEach(function (listener) {\n    listener(this.node, event)\n  }.bind(this))\n}\n\n/**\n   * Private event handler used when listening to some specific key presses\n   * (namely ESCAPE and TAB)\n   *\n   * @access private\n   * @param {Event} event\n   */\nA11yDialog.prototype._bindKeypress = function (event) {\n  // If the dialog is shown and the ESCAPE key is being pressed, prevent any\n  // further effects from the ESCAPE key and hide the dialog\n  if (this.shown && event.which === ESCAPE_KEY) {\n    event.preventDefault()\n    this.hide()\n  }\n\n  // If the dialog is shown and the TAB key is being pressed, make sure the\n  // focus stays trapped within the dialog element\n  if (this.shown && event.which === TAB_KEY) {\n    trapTabKey(this.node, event)\n  }\n}\n\n/**\n   * Private event handler used when making sure the focus stays within the\n   * currently open dialog\n   *\n   * @access private\n   * @param {Event} event\n   */\nA11yDialog.prototype._maintainFocus = function (event) {\n  // If the dialog is shown and the focus is not within the dialog element,\n  // move it back to its first focusable child\n  if (this.shown && !this.node.contains(event.target)) {\n    setFocusToFirstItem(this.node)\n  }\n}\n\n/**\n   * Convert a NodeList into an array\n   *\n   * @param {NodeList} collection\n   * @return {Array<Element>}\n   */\nfunction toArray (collection) {\n  return Array.prototype.slice.call(collection)\n}\n\n/**\n   * Query the DOM for nodes matching the given selector, scoped to context (or\n   * the whole document)\n   *\n   * @param {String} selector\n   * @param {Element} [context = document]\n   * @return {Array<Element>}\n   */\nfunction $$ (selector, context) {\n  return toArray((context || document).querySelectorAll(selector))\n}\n\n/**\n   * Return an array of Element based on given argument (NodeList, Element or\n   * string representing a selector)\n   *\n   * @param {(NodeList | Element | string)} target\n   * @return {Array<Element>}\n   */\nfunction collect (target) {\n  if (NodeList.prototype.isPrototypeOf(target)) { // eslint-disable-line no-prototype-builtins\n    return toArray(target)\n  }\n\n  if (Element.prototype.isPrototypeOf(target)) { // eslint-disable-line no-prototype-builtins\n    return [target]\n  }\n\n  if (typeof target === 'string') {\n    return $$(target)\n  }\n}\n\n/**\n   * Set the focus to the first focusable child of the given element\n   *\n   * @param {Element} node\n   */\nfunction setFocusToFirstItem (node) {\n  const focusableChildren = getFocusableChildren(node)\n\n  if (focusableChildren.length) {\n    focusableChildren[0].focus()\n  }\n}\n\nfunction isAncestor (node, ancestor) {\n  let parent = node\n  while (parent) {\n    parent = parent.parentElement\n    if (parent === ancestor) {\n      return true\n    }\n  }\n  return false\n}\n\n/**\n   * Get the focusable children of the given element\n   *\n   * @param {Element} node\n   * @return {Array<Element>}\n   */\nfunction getFocusableChildren (node) {\n  const candidateFocusableChildren = $$(FOCUSABLE_ELEMENTS_QUERY, node)\n  for (const shadowRoot of shadowRoots) {\n    if (isAncestor(shadowRoot.getRootNode().host, node)) {\n      // TODO: technically we should figure out the host's position in the DOM\n      // and insert the children there, but this works for the emoji picker dialog well\n      // enough, and that's our only shadow root, so it's fine for now.\n      candidateFocusableChildren.push(...shadowRoot.querySelectorAll(FOCUSABLE_ELEMENTS_QUERY))\n    }\n  }\n  return candidateFocusableChildren.filter(child => {\n    return !child.disabled &&\n    !/^-/.test(child.getAttribute('tabindex') || '') &&\n    !child.hasAttribute('inert') && // see https://github.com/GoogleChrome/inert-polyfill\n    (child.offsetWidth || child.offsetHeight || child.getClientRects().length)\n  })\n}\n\n/**\n   * Trap the focus inside the given element\n   *\n   * @param {Element} node\n   * @param {Event} event\n   */\nfunction trapTabKey (node, event) {\n  const focusableChildren = getFocusableChildren(node)\n  let activeElement = document.activeElement\n  for (const shadowRoot of shadowRoots) {\n    if (shadowRoot.getRootNode().host === activeElement) {\n      activeElement = shadowRoot.activeElement\n      break\n    }\n  }\n  const focusedItemIndex = focusableChildren.indexOf(activeElement)\n\n  // If the SHIFT key is being pressed while tabbing (moving backwards) and\n  // the currently focused item is the first one, move the focus to the last\n  // focusable item from the dialog element\n  if (event.shiftKey && focusedItemIndex === 0) {\n    focusableChildren[focusableChildren.length - 1].focus()\n    event.preventDefault()\n    // If the SHIFT key is not being pressed (moving forwards) and the currently\n    // focused item is the last one, move the focus to the first focusable item\n    // from the dialog element\n  } else if (!event.shiftKey && focusedItemIndex === focusableChildren.length - 1) {\n    focusableChildren[0].focus()\n    event.preventDefault()\n  }\n}\n\n/**\n   * Retrieve siblings from given element\n   *\n   * @param {Element} node\n   * @return {Array<Element>}\n   */\nfunction getSiblings (node) {\n  const nodes = toArray(node.parentNode.childNodes)\n  const siblings = nodes.filter(function (node) {\n    return node.nodeType === 1\n  })\n\n  siblings.splice(siblings.indexOf(node), 1)\n\n  return siblings\n}\n\nfunction registerShadowRoot (shadowRoot) {\n  if (!shadowRoots.includes(shadowRoot)) {\n    shadowRoots.push(shadowRoot)\n  }\n}\n\nfunction unregisterShadowRoot (shadowRoot) {\n  const index = shadowRoots.indexOf(shadowRoot)\n  if (index !== -1) {\n    shadowRoots.splice(index, 1)\n  }\n}\n\nexport { A11yDialog, registerShadowRoot, unregisterShadowRoot }\n"],"sourceRoot":""}