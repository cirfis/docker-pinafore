(this.webpackChunkpinafore=this.webpackChunkpinafore||[]).push([[7396],{7526:(t,e,r)=>{"use strict";r.d(e,{V:()=>n});var s=r(8273),a=r(1029);async function n(t,e,r,n,o,i){const l=function(t){switch(t){case"local":case"federated":return"timelines/public";case"home":return"timelines/home";case"notifications":case"notifications/mentions":return"notifications";case"favorites":return"favourites";case"direct":return"conversations";case"bookmarks":return"bookmarks"}if(t.startsWith("tag/"))return"timelines/tag";if(t.startsWith("account/"))return"accounts";if(t.startsWith("list/"))return"timelines/list";throw new Error(`Invalid timeline type: ${t}`)}(r);let c=`${(0,a.E)(t)}/api/v1/${l}`;r.startsWith("tag/")?c+="/"+r.split("/")[1]:r.startsWith("account/")?c+="/"+r.split("/")[1]+"/statuses":r.startsWith("list/")&&(c+="/"+r.split("/")[1]);const d={};o&&(d.since_id=o),n&&(d.max_id=n),i&&(d.limit=i),"local"===r&&(d.local=!0),r.startsWith("account/")&&(r.endsWith("media")?d.only_media=!0:d.exclude_replies=!r.endsWith("/with_replies")),"notifications/mentions"===r&&(d.exclude_types=["follow","favourite","reblog","poll"]),c+="?"+(0,s.pe)(d);let{json:u,headers:p}=await(0,s.SM)(c,(0,a.I)(e),{timeout:s.EH});return"direct"===r&&(u=u.map((t=>t.last_status))),{items:u,headers:p}}},7396:(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>E});var s=r(4178),a=r(8311),n=r(372),o=r(9731),i=r(7421),l=r(1031),c=r(2936),d=r(7526);var u=r(4286),p=r(6494),h=r(1029),f=r(8273);var m=r(7265);async function v(t,e,r,s){const{currentInstance:a,accessToken:n}=c.h.get();try{await async function(t,e,r,s,a,n){const o=`${(0,h.E)(t)}/api/v1/reports`;return(0,f.v_)(o,{account_id:r,status_ids:s,comment:a,forward:n},(0,h.I)(e))}(a,n,t.id,e,r,s),p.A.say("Submitted report")}catch(o){p.A.say((0,m.A)(["Failed to report: ",["error"]],{error:o.message||""}))}}var y={show:o.$,close:i.x,onChange(t,e){const r=e.target.checked,{reportMap:s}=this.get();s[t]=r},async doReport(){const{displayStatuses:t,account:e,comment:r,forward:s,reportMap:a}=this.get(),n=t.map((({id:t})=>t)).filter((t=>a[t]));n.length?await v(e,n,r,s):p.A.say("No toots to report")}};async function g(){l.U.call(this);const{account:t,status:e,reportMap:r}=this.get();e&&(r[e.id]=!0);try{const e=await async function(t){const{currentInstance:e,accessToken:r}=c.h.get();return(await(0,d.V)(e,r,`account/${t}`,null,null,20)).items}(t.id);this.set({recentStatuses:e})}catch(s){console.error(s),p.A.say((0,m.A)(["Unable to load recent toots: ",["error"]],{error:s.message||""}))}finally{this.set({loading:!1})}}function w(t){const{component:e,ctx:r}=this._svelte;e.onChange(r.status.id,t)}function x(t,e,r){const s=Object.create(t);return s.status=e[r],s}function b(t,e){var r,a=[],n=(0,s.L7)(),o=e.displayStatuses;const i=t=>t.status.id;for(var l=0;l<o.length;l+=1){let r=x(e,o,l),s=i(r);a[l]=n[s]=q(t,s,r)}return{c(){for(r=(0,s.az)("ul"),l=0;l<a.length;l+=1)a[l].c();this.h()},l(t){r=(0,s.d$)(t,"UL",{class:!0},!1);var e=(0,s.pI)(r);for(l=0;l<a.length;l+=1)a[l].l(e);e.forEach(s.r2),this.h()},h(){r.className="svelte-1jqy48r"},m(t,e){for((0,s.$T)(t,r,e),l=0;l<a.length;l+=1)a[l].m(r,null)},p(e,o){const l=o.displayStatuses;a=(0,s.$q)(a,t,e,i,1,o,l,n,r,s.pp,q,"m",null,x)},d(t){for(t&&(0,s.r2)(r),l=0;l<a.length;l+=1)a[l].d()}}}function _(t,e){var r,a=new n.Z({root:t.root,store:t.store});return{c(){r=(0,s.az)("div"),a._fragment.c(),this.h()},l(t){r=(0,s.d$)(t,"DIV",{class:!0},!1);var e=(0,s.pI)(r);a._fragment.l(e),e.forEach(s.r2),this.h()},h(){r.className="loading-spinner-container svelte-1jqy48r"},m(t,e){(0,s.$T)(t,r,e),a._mount(r,null)},p:s.ZT,d(t){t&&(0,s.r2)(r),a.destroy()}}}function q(t,e,r){var a,n,o,i,l,c,d,u,p,h=r.status.text;return{key:e,first:null,c(){a=(0,s.az)("li"),n=(0,s.az)("input"),c=(0,s.rw)("\n                "),d=(0,s.az)("label"),u=(0,s.rw)(h),this.h()},l(t){a=(0,s.d$)(t,"LI",{class:!0},!1);var e=(0,s.pI)(a);n=(0,s.d$)(e,"INPUT",{type:!0,id:!0,name:!0,checked:!0,class:!0},!1),(0,s.pI)(n).forEach(s.r2),c=(0,s.M4)(e,"\n                "),d=(0,s.d$)(e,"LABEL",{for:!0,class:!0},!1);var r=(0,s.pI)(d);u=(0,s.M4)(r,h),r.forEach(s.r2),e.forEach(s.r2),this.h()},h(){n._svelte={component:t,ctx:r},(0,s.NH)(n,"change",w),(0,s.P$)(n,"type","checkbox"),n.id=o="status-report-"+r.status.id,n.name=i="status-report-"+r.status.id,n.checked=l=r.status.report,n.className="svelte-1jqy48r",d.htmlFor=p="status-report-"+r.status.id,d.className="svelte-1jqy48r",a.className="svelte-1jqy48r",this.first=a},m(t,e){(0,s.$T)(t,a,e),(0,s.R3)(a,n),(0,s.R3)(a,c),(0,s.R3)(a,d),(0,s.R3)(d,u)},p(t,e){r=e,n._svelte.ctx=r,t.displayStatuses&&o!==(o="status-report-"+r.status.id)&&(n.id=o),t.displayStatuses&&i!==(i="status-report-"+r.status.id)&&(n.name=i),t.displayStatuses&&l!==(l=r.status.report)&&(n.checked=l),t.displayStatuses&&h!==(h=r.status.text)&&(0,s.a_)(u,h),t.displayStatuses&&p!==(p="status-report-"+r.status.id)&&(d.htmlFor=p)},d(t){t&&(0,s.r2)(a),(0,s.ys)(n,"change",w)}}}function j(t,e){var r,a,n,o,i,l,c;function d(){t.set({forward:o.checked})}return{c(){r=(0,s.az)("p"),a=(0,s.rw)(e.forwardDescription),n=(0,s.rw)("\n          "),o=(0,s.az)("input"),i=(0,s.rw)("\n          "),l=(0,s.az)("label"),c=(0,s.rw)(e.forwardLabel),this.h()},l(t){r=(0,s.d$)(t,"P",{class:!0},!1);var d=(0,s.pI)(r);a=(0,s.M4)(d,e.forwardDescription),d.forEach(s.r2),n=(0,s.M4)(t,"\n          "),o=(0,s.d$)(t,"INPUT",{type:!0,id:!0,name:!0},!1),(0,s.pI)(o).forEach(s.r2),i=(0,s.M4)(t,"\n          "),l=(0,s.d$)(t,"LABEL",{for:!0,class:!0},!1);var u=(0,s.pI)(l);c=(0,s.M4)(u,e.forwardLabel),u.forEach(s.r2),this.h()},h(){r.className="svelte-1jqy48r",(0,s.NH)(o,"change",d),(0,s.P$)(o,"type","checkbox"),o.id="report-forward",o.name="report-forward",l.htmlFor="report-forward",l.className="svelte-1jqy48r"},m(t,d){(0,s.$T)(t,r,d),(0,s.R3)(r,a),(0,s.$T)(t,n,d),(0,s.$T)(t,o,d),o.checked=e.forward,(0,s.$T)(t,i,d),(0,s.$T)(t,l,d),(0,s.R3)(l,c)},p(t,e){t.forwardDescription&&(0,s.a_)(a,e.forwardDescription),t.forward&&(o.checked=e.forward),t.forwardLabel&&(0,s.a_)(c,e.forwardLabel)},d(t){t&&((0,s.r2)(r),(0,s.r2)(n),(0,s.r2)(o)),(0,s.ys)(o,"change",d),t&&((0,s.r2)(i),(0,s.r2)(l))}}}function I(t){var e;if((0,s.S1)(this,t),this.store=c.h,this._state=(0,s.f0)((0,s.f0)(this.store._init(["currentInstance"]),{account:void 0,status:void 0,positiveText:"Report",reportMap:{},recentStatuses:[],loading:!0,forward:!1,comment:""}),t.data),this.store._add(this,["currentInstance"]),this._recompute({status:1,recentStatuses:1,statuses:1,reportMap:1,account:1,$currentInstance:1,remoteInstance:1},this._state),this._intro=!0,this._handlers.destroy=[s.iT],document.getElementById("svelte-1jqy48r-style")||((e=(0,s.az)("style")).id="svelte-1jqy48r-style",e.textContent=".report-dialog-contents .confirmation-dialog-form{max-width:80vw}.report-dialog.svelte-1jqy48r{padding:20px 40px;overflow-y:auto}.loading-spinner-container.svelte-1jqy48r{width:100%;height:100%;display:flex;justify-content:center;align-items:center}ul.svelte-1jqy48r{list-style:none;max-height:30vh;overflow-y:auto;overflow-x:hidden;border:1px solid var(--main-border)}li.svelte-1jqy48r{padding:10px 5px;border-top:1px solid var(--main-border)}li.svelte-1jqy48r:first-child{border-top:none}.recent-statuses.svelte-1jqy48r label.svelte-1jqy48r{padding:10px 5px;display:-webkit-box;-webkit-line-clamp:5;-webkit-box-orient:vertical}textarea.svelte-1jqy48r{width:100%;overflow-y:auto;max-height:40vh;font-size:1.3em;min-height:100px}p.svelte-1jqy48r{margin:20px 0}.recent-statuses.svelte-1jqy48r li.svelte-1jqy48r{display:flex;flex-direction:row;align-items:center}.recent-statuses.svelte-1jqy48r input.svelte-1jqy48r{margin-right:10px}.recent-statuses.svelte-1jqy48r label.svelte-1jqy48r{width:0;flex:1;word-wrap:break-word;overflow:hidden;white-space:pre-wrap;text-overflow:ellipsis;border-left:1px solid var(--main-border);padding-left:10px}.report-flex.svelte-1jqy48r{display:flex;flex-direction:row}.report-flex.svelte-1jqy48r>.svelte-1jqy48r{flex:1}.report-info.svelte-1jqy48r{margin-left:20px}@media(max-width: 767px){.report-dialog.svelte-1jqy48r{padding:20px;overflow-x:hidden;max-height:65vh}.report-flex.svelte-1jqy48r{flex-direction:column}.report-info.svelte-1jqy48r{margin-left:0}textarea.svelte-1jqy48r{max-height:20vh}p.svelte-1jqy48r,label.svelte-1jqy48r{word-wrap:break-word}.report-dialog-contents .confirmation-dialog-form{max-width:calc(100% - 20px)}}",(0,s.R3)(document.head,e)),this._fragment=function(t,e){var r,n,o,i,l,c,d,u,p,h,f,m,v,y=!1;function g(t){return t.loading?_:b}var w=g(e),x=w(t,e);function q(){y=!0,t.set({comment:m.value}),y=!1}var I=e.remoteInstance&&j(t,e),$={id:e.id,label:e.label,title:e.title,className:"report-dialog-contents",positiveText:e.positiveText},T=new a.Z({root:t.root,store:t.store,slots:{default:(0,s.xJ)()},data:$});return T.on("positive",(function(e){t.doReport()})),{c(){r=(0,s.az)("div"),n=(0,s.az)("div"),o=(0,s.az)("div"),x.c(),i=(0,s.rw)("\n      "),l=(0,s.az)("div"),c=(0,s.az)("p"),d=(0,s.rw)(e.reportingLabel),u=(0,s.rw)("\n        "),p=(0,s.az)("label"),h=(0,s.rw)("Additional comments"),f=(0,s.rw)("\n        "),m=(0,s.az)("textarea"),v=(0,s.rw)("\n        "),I&&I.c(),T._fragment.c(),this.h()},l(t){r=(0,s.d$)(t,"DIV",{class:!0},!1);var a=(0,s.pI)(r);n=(0,s.d$)(a,"DIV",{class:!0},!1);var y=(0,s.pI)(n);o=(0,s.d$)(y,"DIV",{class:!0},!1);var g=(0,s.pI)(o);x.l(g),g.forEach(s.r2),i=(0,s.M4)(y,"\n      "),l=(0,s.d$)(y,"DIV",{class:!0},!1);var w=(0,s.pI)(l);c=(0,s.d$)(w,"P",{class:!0},!1);var b=(0,s.pI)(c);d=(0,s.M4)(b,e.reportingLabel),b.forEach(s.r2),u=(0,s.M4)(w,"\n        "),p=(0,s.d$)(w,"LABEL",{class:!0,id:!0},!1);var _=(0,s.pI)(p);h=(0,s.M4)(_,"Additional comments"),_.forEach(s.r2),f=(0,s.M4)(w,"\n        "),m=(0,s.d$)(w,"TEXTAREA",{placeholder:!0,"aria-labelledby":!0,maxlength:!0,class:!0},!1),(0,s.pI)(m).forEach(s.r2),v=(0,s.M4)(w,"\n        "),I&&I.l(w),w.forEach(s.r2),y.forEach(s.r2),a.forEach(s.r2),T._fragment.l(t),this.h()},h(){o.className="recent-statuses svelte-1jqy48r",c.className="svelte-1jqy48r",p.className="sr-only svelte-1jqy48r",p.id="comments-label",(0,s.NH)(m,"input",q),m.placeholder="Additional comments",(0,s.P$)(m,"aria-labelledby","comments-label"),m.maxLength="1000",m.className="svelte-1jqy48r",l.className="report-info svelte-1jqy48r",n.className="report-flex svelte-1jqy48r",r.className="report-dialog svelte-1jqy48r"},m(t,a){(0,s.R3)(T._slotted.default,r),(0,s.R3)(r,n),(0,s.R3)(n,o),x.m(o,null),(0,s.R3)(n,i),(0,s.R3)(n,l),(0,s.R3)(l,c),(0,s.R3)(c,d),(0,s.R3)(l,u),(0,s.R3)(l,p),(0,s.R3)(p,h),(0,s.R3)(l,f),(0,s.R3)(l,m),m.value=e.comment,(0,s.R3)(l,v),I&&I.m(l,null),T._mount(t,a)},p(e,r){w===(w=g(r))&&x?x.p(e,r):(x.d(1),(x=w(t,r)).c(),x.m(o,null)),e.reportingLabel&&(0,s.a_)(d,r.reportingLabel),!y&&e.comment&&(m.value=r.comment),r.remoteInstance?I?I.p(e,r):((I=j(t,r)).c(),I.m(l,null)):I&&(I.d(1),I=null);var a={};e.id&&(a.id=r.id),e.label&&(a.label=r.label),e.title&&(a.title=r.title),e.positiveText&&(a.positiveText=r.positiveText),T._set(a)},d(t){x.d(),(0,s.ys)(m,"input",q),I&&I.d(),T.destroy(t)}}}(this,this._state),this.root._oncreate.push((()=>{g.call(this),this.fire("update",{changed:(0,s.lZ)({},this._state),current:this._state})})),t.target){var r=(0,s.pI)(t.target);t.hydrate?this._fragment.l(r):this._fragment.c(),r.forEach(s.r2),this._mount(t.target,t.anchor),(0,s.yl)(this)}}(0,s.f0)(I.prototype,s.uS),(0,s.f0)(I.prototype,y),I.prototype._recompute=function(t,e){(t.status||t.recentStatuses)&&this._differs(e.statuses,e.statuses=function({status:t,recentStatuses:e}){return[t].concat((e||[]).filter((({id:e})=>!t||e!==t.id))).filter(Boolean)}(e))&&(t.statuses=!0),(t.statuses||t.reportMap)&&this._differs(e.displayStatuses,e.displayStatuses=function({statuses:t,reportMap:e}){return t.map((t=>({id:t.id,text:(0,u.g)(t.content,t.mentions)||"(No content)",report:e[t.id]})))}(e))&&(t.displayStatuses=!0),t.account&&this._differs(e.remoteInstance,e.remoteInstance=function({account:t}){return t.acct.split("@")[1]}(e))&&(t.remoteInstance=!0),(t.account||t.$currentInstance)&&this._differs(e.reportingLabel,e.reportingLabel=function({account:t,$currentInstance:e}){return(0,m.A)(["You are reporting ",["account"]," to the moderators of ",["instance"],"."],{account:`@${t.acct}`,instance:e})}(e))&&(t.reportingLabel=!0),t.remoteInstance&&(this._differs(e.forwardDescription,e.forwardDescription=function({remoteInstance:t}){return(0,m.A)(["Forward to the moderators of ",["instance"]," as well?"],{instance:t})}(e))&&(t.forwardDescription=!0),this._differs(e.forwardLabel,e.forwardLabel=function({remoteInstance:t}){return(0,m.A)(["Forward to ",["instance"]],{instance:t})}(e))&&(t.forwardLabel=!0))};const $=I;var T=r(7056);function E({account:t,status:e}){const r=(0,m.A)(["Report ",["account"]],{account:`@${t.acct}`});return(0,T.v)($,{label:r,title:r,account:t,status:e})}},4286:(t,e,r)=>{"use strict";r.d(e,{g:()=>o});var s=r(7569),a=r(4386);const n=new DOMParser;function o(t,e){if(!t)return"";(0,s.B)("statusHtmlToPlainText"),t=(0,a.e)(t);const r=n.parseFromString(t,"text/html");!function(t,e){const r=t.querySelectorAll("a.mention");for(let s=0;s<r.length;s++){const t=r[s],a=t.getAttribute("href"),n=e.find((t=>t.url===a));n&&(t.innerText=`@${n.acct}`)}}(r,e);const o=function(t){let e="";const r=t.querySelectorAll("p");for(let s=0;s<r.length;s++){const a=r[s],n=a.querySelectorAll("br");for(let e=0;e<n.length;e++){const r=n[e];r.parentNode.replaceChild(t.createTextNode("\n"),r)}e+=(s>0?"\n\n":"")+a.textContent}return e}(r);return(0,s.s)("statusHtmlToPlainText"),o}}}]);
//# sourceMappingURL=7396.cf9d44abdc47a5eae425.7396.js.map